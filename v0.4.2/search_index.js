var documenterSearchIndex = {"docs":
[{"location":"#TrajGWAS.jl","page":"Home","title":"TrajGWAS.jl","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"TrajGWAS.jl is a Julia package for performing genome-wide association studies (GWAS) for continuous longitudinal phenotypes using a modified linear mixed effects model. It builds upon the within-subject variance estimation by robust regression (WiSER) method and can be used to identify variants associated with changes in the mean and within-subject variability of the longitduinal trait. The estimation procedure is robust to distributional misspecifications of both the random effects and the response. A saddlepoint approximation (SPA) option is implemented to provide improved power and calibrated type I error for rare variants. ","category":"page"},{"location":"","page":"Home","title":"Home","text":"TrajGWAS.jl currently supports PLINK, VCF (both dosage and genotype data), and BGEN file formats. We plan to add PGEN support in the future. ","category":"page"},{"location":"#Installation","page":"Home","title":"Installation","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"This package requires Julia v1.6 or later. The package is registered and can be installed using the command:","category":"page"},{"location":"","page":"Home","title":"Home","text":"using Pkg\npkg\"add TrajGWAS\"","category":"page"},{"location":"","page":"Home","title":"Home","text":"To run the code in this document, the packages installed by the following command are also necessary:","category":"page"},{"location":"","page":"Home","title":"Home","text":"pkg\"add BenchmarkTools CSV Glob PrettyTables\"","category":"page"},{"location":"","page":"Home","title":"Home","text":"# machine information for this tutorial\nversioninfo()","category":"page"},{"location":"","page":"Home","title":"Home","text":"Julia Version 1.7.1\nCommit ac5cc99908 (2021-12-22 19:35 UTC)\nPlatform Info:\n  OS: macOS (x86_64-apple-darwin19.5.0)\n  CPU: Intel(R) Core(TM) i7-7820HQ CPU @ 2.90GHz\n  WORD_SIZE: 64\n  LIBM: libopenlibm\n  LLVM: libLLVM-12.0.1 (ORCJIT, skylake)","category":"page"},{"location":"","page":"Home","title":"Home","text":"# for use in this tutorial\nENV[\"COLUMNS\"] = 400\nusing BenchmarkTools, CSV, Glob, SnpArrays, TrajGWAS, PrettyTables","category":"page"},{"location":"#Example-data-sets","page":"Home","title":"Example data sets","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"The data folder of the package contains the example data sets for use with PLINK and VCF Files. In general, the user can locate this folder by command:","category":"page"},{"location":"","page":"Home","title":"Home","text":"pvalpath = \"trajgwas.pval.txt\"\nnullpath = \"trajgwas.null.txt\"\nconst datadir = normpath(joinpath(dirname(pathof(TrajGWAS)), \"../data/\"))","category":"page"},{"location":"","page":"Home","title":"Home","text":"\"/Users/xyz/.julia/dev/TrajGWAS/data/\"","category":"page"},{"location":"","page":"Home","title":"Home","text":"# content of the data folder\nreaddir(glob\"*.*\", datadir)","category":"page"},{"location":"","page":"Home","title":"Home","text":"14-element Vector{String}:\n \"/Users/xyz/.julia/dev/TrajGWAS/data/bgen_snpsetfile.txt\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/covariate.txt\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/example.8bits.bgen\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/example.8bits.bgen.bgi\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.bed\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.bim\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.fam\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap_snpsetfile.txt\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/sim_data.jl\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/snpsetfile_vcf.txt\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/test_vcf.vcf.gz\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/trajgwas_bgen_ex.csv\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/trajgwas_plinkex.csv\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/trajgwas_vcfex.csv\"","category":"page"},{"location":"","page":"Home","title":"Home","text":"The hapmap3 files trajgwas_plinkex.csv file correspond to data examples using PLINK formatted files (.bed, .bim, .fam). ","category":"page"},{"location":"","page":"Home","title":"Home","text":"The test_vcf.vcf.gz and trajgwas_vcfex.csv files are for an example analysis using VCF formatted files. ","category":"page"},{"location":"","page":"Home","title":"Home","text":"The example.8bits.bgen and trajgwas_bgen_ex.csv files are for an example analysis using VCF formatted files. ","category":"page"},{"location":"#Basic-usage","page":"Home","title":"Basic usage","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"The following command performs GWAS using for the hapmap3 PLINK files. The output is the fitted null model.","category":"page"},{"location":"","page":"Home","title":"Home","text":"The default type of GWAS performed is a single-snp significance genome-wide scan, this can be changed by the keyword analysistype (default is \"singlesnp\"). Other types of analyses are covered later. It outputs the null model, runtime of fitting the null model, and convergence metrics. ","category":"page"},{"location":"","page":"Home","title":"Home","text":"trajgwas(@formula(y ~ 1 + sex + onMeds),\n        @formula(y ~ 1),\n        @formula(y ~ 1 + sex + onMeds),\n        :id,\n        datadir * \"trajgwas_plinkex.csv\",\n        datadir * \"hapmap3\",\n        pvalfile = pvalpath,\n        nullfile = nullpath)","category":"page"},{"location":"","page":"Home","title":"Home","text":"******************************************************************************\nThis program contains Ipopt, a library for large-scale nonlinear optimization.\n Ipopt is released as open source code under the Eclipse Public License (EPL).\n         For more information visit https://github.com/coin-or/Ipopt\n******************************************************************************\n\nrun = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.430740\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.039891\n\n\n\n\n\n\nWithin-subject variance estimation by robust regression (WiSER)\n\nMean Formula:\ny ~ 1 + sex + onMeds\nRandom Effects Formula:\ny ~ 1\nWithin-Subject Variance Formula:\ny ~ 1 + sex + onMeds\n\nNumber of individuals/clusters: 324\nTotal observations: 3240\n\nFixed-effects parameters:\n────────────────────────────────────────────────────────\n                  Estimate  Std. Error       Z  Pr(>|Z|)\n────────────────────────────────────────────────────────\nβ1: (Intercept)  13.2282     0.146459    90.32    <1e-99\nβ2: sex          -3.29295    0.2101     -15.67    <1e-54\nβ3: onMeds        0.459585   0.0596002    7.71    <1e-13\nτ1: (Intercept)   0.792508   0.0850728    9.32    <1e-19\nτ2: sex          -0.2865     0.0970732   -2.95    0.0032\nτ3: onMeds        0.422303   0.063825     6.62    <1e-10\n────────────────────────────────────────────────────────\nRandom effects covariance matrix Σγ:\n \"γ1: (Intercept)\"  3.32057","category":"page"},{"location":"","page":"Home","title":"Home","text":"For documentation of the trajgwas function, type ?trajgwas in Julia REPL.","category":"page"},{"location":"","page":"Home","title":"Home","text":"trajgwas","category":"page"},{"location":"#TrajGWAS.trajgwas","page":"Home","title":"TrajGWAS.trajgwas","text":"trajgwas(nullmeanformula, reformula, nullwsvarformula, idvar, covfile, geneticfile; kwargs...)\ntrajgwas(nullmeanformula, reformula, nullwsvarformula, idvar, df, geneticfile; kwargs...)\ntrajgwas(fittednullmodel, geneticfile; kwargs...)\ntrajgwas(fittednullmodel, bedfile, bimfile, bedn; kwargs...)\ntrajgwas(fittednullmodel, vcffile, nsamples, vcftype; kwargs...)\ntrajgwas(fittednullmodel, bgenfile, nsamples; kwargs...)\n\nPositional arguments\n\nnullmeanformula::FormulaTerm: mean formula (β) for the null model.\nreformula::FormulaTerm: random effects formula (γ) for the model.\nnullwsvarformula::FormulaTerm: within-subject variance formula (τ) for the null model.\nidvar::Union{String, Symbol}: id variable for groupings.\ncovfile::AbstractString: covariate file (csv) with one header line. One column   should be the longitudinal phenotype.\ndf::DataFrame: DataFrame containing response and regressors for null model.\ngeneticfile::Union{Nothing, AbstractString}: File containing genetic information for GWAS.   This includes a PLINK file name without the .bed, .fam, or .bim   extensions or a VCF file without the .vcf extension. If geneticfile==nothing,   only null model is fitted. If geneticfile is provided, bed, bim, and fam file (or vcf) with   the same geneticfile prefix need to exist. Compressed file formats such as gz and bz2   are allowed. Check all allowed formats by SnpArrays.ALLOWED_FORMAT. If you're using a VCF file,   make sure to use the geneticformat = \"VCF\" keyword option, and specificy dosage (:DS) or   genotype (:GT) data with the vcftype command.\nfittednullmodel::StatsModels.TableRegressionModel: the fitted null model   output from trajgwas(nullformula, covfile) or trajgwas(nullformula, df).   NOTE If the nullmodel is passed in with the bedfile, bimfile, bedn or    vcffile, nsamples, vcftype arguments, the IDs/data in the null model must match the   order of the IDs in the PLINK/VCF file.  \nbedfile::Union{AbstractString,IOStream}: path to Plink bed file with full file name.\nbimfile::Union{AbstractString,IOStream}: path to Plink bim file with full file name.\nbedn::Integer: number of samples in bed/vcf file.\n\nKeyword arguments\n\nanalysistype::AbstractString: Type of analysis to conduct. Default is singlesnp. Other options are snpset and gxe.\ngeneticformat::AbstractString: Type of file used for the genetic analysis. \"PLINK\" and \"VCF\" are currently supported. Default is PLINK.\nvcftype::Union{Symbol, Nothing}: Data to extract from the VCF file for the GWAS analysis. :DS for dosage or :GT for genotypes. Default is nothing.\nnullfile::Union{AbstractString, IOStream}: output file for the fitted null model;   default is trajgwas.null.txt.\npvalfile::Union{AbstractString, IOStream}: output file for the gwas p-values; default is   trajgwas.pval.txt.\ncovtype::Vector{DataType}: type information for covfile. This is useful   when CSV.read(covarfile) has parsing errors.\ncovrowinds::Union{Nothing,AbstractVector{<:Integer}}: sample indices for covariate file.\ntestformula::FormulaTerm: formula for test unit. Default is @formula(trait ~ 0 + snp).\ntest::Symbol: :score (default) or :wald.\ndisable_wsvar::Bool: Disables test for within-sample variability for the Wald test. Default false. \nlink::GLM.Link: LogitLink() (default), ProbitLink(), CauchitLink(),   or CloglogLink().\nsnpmodel: ADDITIVE_MODEL (default), DOMINANT_MODEL, or RECESSIVE_MODEL.\nsnpinds::Union{Nothing,AbstractVector{<:Integer}}: SNP indices for bed/vcf file.\ngeneticrowinds::Union{Nothing,AbstractVector{<:Integer}}: sample indices for bed/vcf file.\nsamplepath::Union{Nothing, AbstractString}: path for BGEN sample file if it's not encoded in the BGEN file.\nsolver: an optimizer supported by MathOptInterface. Default is   Ipopt.Optimizer().\nsolver_config: Dict of configuration keys and values for the optimizer. Default is   Dict(\"print_level\" => 0, \"mehrotra_algorithm\" => \"yes\", \"warm_start_init_point\" => \"yes\",   \"max_iter\" => 100).\nruns::Integer: Number of weighted NLS runs for the null model; default is 2.   Each run will use the newest m.τ and m.Lγ to update the weight matrices   Vi and solve the new weighted NLS.\nparallel::Bool: Multi-threading or not for fitting the null model. Default is false.\nverbose::Bool: default is false.\nsnpset::Union{Nothing, Integer, AbstractString, AbstractVector{<:Integer}}: Only include   if you are conducting a snpset analysis. An integer indicates a window of SNPs   (i.e. every 500 snps). An abstract string allows you to specify an input file,   with no header and two columns separated by a space. The first column must contain the snpset ID   and the second column must contain the snpid's identical to the bimfile. An AbstractVector   allows you to specify the snps you want to perform one joint snpset test for.\ne::Union{AbstractString,Symbol}: Only include if you are conducting a GxE analysis.   Enviromental variable to be used to test the GxE interaction.   For instance, for testing sex & snp interaction, use :sex or \"sex\".\n\nExamples\n\nThe following is an example of basic GWAS with PLINK files:\n\nplinkfile = \"plinkexample\"\ncovfile = \"covexample\"\ntrajgwas(@formula(trait ~ sex), covfile, plkfile)\n\nThe following is an example of basic GWAS with a VCF file using dosages then genotypes:\n\nvcffile = \"vcfexample\"\ncovfile = \"covexample\"\ntrajgwas(@formula(trait ~ sex), covfile, vcffile;\n    geneticfile = \"VCF\", vcftype = :DS)\n\ntrajgwas(@formula(trait ~ sex), covfile, vcffile;\n    geneticfile = \"VCF\", vcftype = :GT)\n\nThe following is an example of snpset GWAS (every 50 snps). For more types of snpset analyses see documentation:\n\ntrajgwas(@formula(trait ~ sex), covfile, plkfile;\n    analysistype = \"snpset\", snpset = 50)\n\nThe following is an example of GxE GWAS testing the interaction effect:\n\ntrajgwas(@formula(trait ~ sex), covfile, plkfile;\n    analysistype = \"gxe\", e = :sex)\n\n\n\n\n\n","category":"function"},{"location":"#Formula-for-null-model","page":"Home","title":"Formula for null model","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"The first three arguments specify the null model without SNP effects. The fourth argument specifies the grouping variable (subject ID, cluster, etc.).","category":"page"},{"location":"","page":"Home","title":"Home","text":"The first term is the mean fixed effects formula e.g., @formula(y ~ 1 + sex + onMeds).\nThe second argument is the random (location) effects – @formula(y ~ 1) specifies a random intercept, whereas @formula(y ~ 1 + time) would specify a random intercept and slope (time).\nThe third argument specifies the within-subject variance (WSV) formula @formula(y ~ 1 + sex + onMeds) models the intra-individual variability of y with an intercept, sex, and medication. Note: The WSV formula must have an intercept. \nThe fourth argument specifies the grouping variable of the longitudinal data. In the example data, the id variable specifies the grouping variable the repeated measures are collected on. ","category":"page"},{"location":"#Input-files","page":"Home","title":"Input files","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"trajgwas expects two input files: one for responses plus covariates (fifth argument) in long format, the other the genetic file(s) for dosages/genotypes (sixth argument).","category":"page"},{"location":"#Covariate-and-trait-file","page":"Home","title":"Covariate and trait file","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"Covariates and phenotype are provided in a csv file, e.g., trajgwas_plinkex.csv, which has one header line for variable names. In this example, variable y is continuous variable with repeated measures on individuals specified by id. We want to include variable sex and onMeds as covariates for GWAS.","category":"page"},{"location":"","page":"Home","title":"Home","text":"run(`head $(datadir)trajgwas_plinkex.csv`);","category":"page"},{"location":"","page":"Home","title":"Home","text":"sex,onMeds,snp1,snp2,snp3,snp4,y,id\n0.0,1.0,0.0,1.0,2.0,0.0,12.26667411332518,A1\n0.0,0.0,0.0,1.0,2.0,0.0,10.268123812744903,A1\n0.0,0.0,0.0,1.0,2.0,0.0,12.165997408822557,A1\n0.0,0.0,0.0,1.0,2.0,0.0,11.879709602937222,A1\n0.0,0.0,0.0,1.0,2.0,0.0,12.812705165990007,A1\n0.0,0.0,0.0,1.0,2.0,0.0,9.987659617201372,A1\n0.0,0.0,0.0,1.0,2.0,0.0,12.140779426464974,A1\n0.0,1.0,0.0,1.0,2.0,0.0,13.205778146177705,A1\n0.0,0.0,0.0,1.0,2.0,0.0,11.363145919060207,A1","category":"page"},{"location":"#Genetic-file(s)","page":"Home","title":"Genetic file(s)","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"TrajGWAS supports PLINK files, VCF files, and BGEN files.","category":"page"},{"location":"","page":"Home","title":"Home","text":"Genotype data is available as binary PLINK files.\nTrajGWAS can use dosage or genotype data from VCF files. \nTrajGWAS uses dosage data from BGEN files.","category":"page"},{"location":"","page":"Home","title":"Home","text":"note: Note\nBy default, TrajGWAS assumes a set of PLINK files will be used. When using a VCF File, VCF file and type of data (dosage, genotype) must be specified by the geneticformat and vcftype options (as shown later). Similarly, BGEN must be specified as the geneticformat if using a BGEN file. ","category":"page"},{"location":"","page":"Home","title":"Home","text":"readdir(glob\"hapmap3.*\", datadir)","category":"page"},{"location":"","page":"Home","title":"Home","text":"3-element Vector{String}:\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.bed\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.bim\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.fam\"","category":"page"},{"location":"","page":"Home","title":"Home","text":"In this example, there are 324 samples at 13,928 SNPs.","category":"page"},{"location":"","page":"Home","title":"Home","text":"size(SnpArray(datadir * \"hapmap3.bed\"))","category":"page"},{"location":"","page":"Home","title":"Home","text":"(324, 13928)","category":"page"},{"location":"","page":"Home","title":"Home","text":"Compressed PLINK and VCF files are supported. For example, if Plink files are hapmap3.bed.gz, hapmap3.bim.gz and hapmap3.fam.gz, the same command","category":"page"},{"location":"","page":"Home","title":"Home","text":"trajgwas(@formula(y ~ 1 + sex + onMeds),\n        @formula(y ~ 1),\n        @formula(y ~ 1 + sex + onMeds),\n        :id,\n        datadir * \"trajgwas_plinkex.csv\",\n        datadir * \"hapmap3\",\n        pvalfile = pvalpath,\n        nullfile = nullpath)","category":"page"},{"location":"","page":"Home","title":"Home","text":"still works. Check all supported compression format by","category":"page"},{"location":"","page":"Home","title":"Home","text":"SnpArrays.ALLOWED_FORMAT","category":"page"},{"location":"","page":"Home","title":"Home","text":"6-element Vector{String}:\n \"gz\"\n \"zlib\"\n \"zz\"\n \"xz\"\n \"zst\"\n \"bz2\"","category":"page"},{"location":"#Output-files","page":"Home","title":"Output files","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"trajgwas outputs two files: trajgwas.null.txt and trajgwas.pval.txt. ","category":"page"},{"location":"","page":"Home","title":"Home","text":"trajgwas.null.txt lists the estimated null model (without SNPs). ","category":"page"},{"location":"","page":"Home","title":"Home","text":"run(`cat trajgwas.null.txt`);","category":"page"},{"location":"","page":"Home","title":"Home","text":"Within-subject variance estimation by robust regression (WiSER)\n\nMean Formula:\ny ~ 1 + sex + onMeds\nRandom Effects Formula:\ny ~ 1\nWithin-Subject Variance Formula:\ny ~ 1 + sex + onMeds\n\nNumber of individuals/clusters: 324\nTotal observations: 3240\n\nFixed-effects parameters:\n────────────────────────────────────────────────────────\n                  Estimate  Std. Error       Z  Pr(>|Z|)\n────────────────────────────────────────────────────────\nβ1: (Intercept)  13.2282     0.146459    90.32    <1e-99\nβ2: sex          -3.29295    0.2101     -15.67    <1e-54\nβ3: onMeds        0.459585   0.0596002    7.71    <1e-13\nτ1: (Intercept)   0.792508   0.0850728    9.32    <1e-19\nτ2: sex          -0.2865     0.0970732   -2.95    0.0032\nτ3: onMeds        0.422303   0.063825     6.62    <1e-10\n────────────────────────────────────────────────────────\nRandom effects covariance matrix Σγ:\n \"γ1: (Intercept)\"  3.32057","category":"page"},{"location":"","page":"Home","title":"Home","text":"trajgwas.pval.txt tallies the SNPs, their pvalues, and relevant information on each SNP.\nbetapval represents the p-value of the SNP's effect on the mean of the trait. If spa=true (default), then this is the SPA p-value. If spa=false, then this is the score test beta p-value. \ntaupval represents the p-value of the SNP's effect on the within-subject variability of the trait. If spa=true (default), then this is the SPA p-value. If spa=false, then this is the score test tau p-value. \njointpval represents a joint p-value of the SNP's effect on both the mean and variance. By default spa=true this is the harmonic mean of the saddlepoint approximated p-values for beta and tau. If spa=false, this is the joint score test p-value.","category":"page"},{"location":"","page":"Home","title":"Home","text":"pretty_table(first(CSV.read(\"trajgwas.pval.txt\", DataFrame), 8), tf = tf_markdown)","category":"page"},{"location":"","page":"Home","title":"Home","text":"|\u001b[1m   chr \u001b[0m|\u001b[1m     pos \u001b[0m|\u001b[1m      snpid \u001b[0m|\u001b[1m        maf \u001b[0m|\u001b[1m     hwepval \u001b[0m|\u001b[1m    betapval \u001b[0m|\u001b[1m betadir \u001b[0m|\u001b[1m     taupval \u001b[0m|\u001b[1m taudir \u001b[0m|\u001b[1m   jointpval \u001b[0m|\n|\u001b[90m Int64 \u001b[0m|\u001b[90m   Int64 \u001b[0m|\u001b[90m   String31 \u001b[0m|\u001b[90m    Float64 \u001b[0m|\u001b[90m     Float64 \u001b[0m|\u001b[90m     Float64 \u001b[0m|\u001b[90m   Int64 \u001b[0m|\u001b[90m     Float64 \u001b[0m|\u001b[90m  Int64 \u001b[0m|\u001b[90m     Float64 \u001b[0m|\n|-------|---------|------------|------------|-------------|-------------|---------|-------------|--------|-------------|\n|     1 |  554484 | rs10458597 |        0.0 |         1.0 |         1.0 |       0 |         1.0 |      0 |         1.0 |\n|     1 |  758311 | rs12562034 |  0.0776398 |    0.409876 |     0.38939 |      -1 |    0.922822 |     -1 |    0.547682 |\n|     1 |  967643 |  rs2710875 |   0.324074 |  4.07625e-7 |  5.83856e-6 |       1 |  3.35408e-6 |     -1 |  4.93598e-7 |\n|     1 | 1168108 | rs11260566 |   0.191589 |    0.128568 | 0.000850889 |       1 |   0.0559055 |      1 |  0.00101827 |\n|     1 | 1375074 |  rs1312568 |   0.441358 |  2.5376e-19 | 0.000171683 |      -1 | 1.84811e-13 |      1 | 2.07091e-15 |\n|     1 | 1588771 | rs35154105 |        0.0 |         1.0 |         1.0 |       0 |         1.0 |      0 |         1.0 |\n|     1 | 1789051 | rs16824508 | 0.00462963 |    0.933278 |    0.295035 |       1 |    0.304109 |      1 |    0.299504 |\n|     1 | 1990452 |  rs2678939 |   0.453704 | 5.07696e-11 |  1.27871e-7 |       1 |  7.73809e-9 |     -1 |   3.3986e-9 |","category":"page"},{"location":"","page":"Home","title":"Home","text":"Output file names can be changed by the nullfile and pvalfile keywords respectively. For example, ","category":"page"},{"location":"","page":"Home","title":"Home","text":"trajgwas(@formula(y ~ 1 + sex + onMeds),\n        @formula(y ~ 1),\n        @formula(y ~ 1 + sex + onMeds),\n        :id,\n        datadir * \"trajgwas_plinkex.csv\",\n        datadir * \"hapmap3\",\n        pvalfile = \"trajgwas.pval.txt.gz\",\n        nullfile = nullpath)\n","category":"page"},{"location":"","page":"Home","title":"Home","text":"will output the p-value file in compressed gz format.","category":"page"},{"location":"#Subsamples","page":"Home","title":"Subsamples","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"Use the keyword covrowinds to specify selected samples in the covarite file. Use the keyword geneticrowinds to specify selected samples in the Plink (.bed), VCF, or BGEN file. For example, to use the first 300 samples in both covariate and bed file:","category":"page"},{"location":"","page":"Home","title":"Home","text":"trajgwas(@formula(trait ~ 1+ sex), \n    @formula(trait ~ 1), \n    @formula(trait ~ 1 + sex), \n    :id,\n    covfile, geneticfile, \n    covrowinds=1:300, geneticrowinds=1:300)","category":"page"},{"location":"","page":"Home","title":"Home","text":"note: Note\nUsers should make sure that the selected samples in covariate file match exactly those in bed file, otherwise an error will be displayed. ","category":"page"},{"location":"#Input-non-genetic-data-as-DataFrame","page":"Home","title":"Input non-genetic data as DataFrame","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"Internally trajgwas parses the covariate file as a DataFrame by df = CSV.read(covfile, DataFrame). For covariate file of other formats, or for specifying default levels of categorical variables, users can parse their datafile as a DataFrame and then input the DataFrame to trajgwas directly.","category":"page"},{"location":"","page":"Home","title":"Home","text":"trajgwas(@formula(trait ~ 1+ sex), \n    @formula(trait ~ 1), \n    @formula(trait ~ 1 + sex),\n    :id,\n    df, geneticfile)","category":"page"},{"location":"","page":"Home","title":"Home","text":"note: Note\nUsers should always make sure that individuals in covariate file or DataFrame match those in Plink fam file/VCF File/BGEN file. ","category":"page"},{"location":"","page":"Home","title":"Home","text":"For example, following code checks that the subject ID of the covariate.txt file match that of the hapmap3.fam file exactly.","category":"page"},{"location":"","page":"Home","title":"Home","text":"covdf = CSV.read(datadir * \"covariate.txt\", DataFrame)\nplkfam = CSV.read(datadir * \"hapmap3.fam\", DataFrame, header=0, delim=' ')\nall(covdf[!, 2] .== plkfam[!, 2])","category":"page"},{"location":"","page":"Home","title":"Home","text":"true","category":"page"},{"location":"","page":"Home","title":"Home","text":"pretty_table(first(covdf, 8), tf = tf_markdown)","category":"page"},{"location":"","page":"Home","title":"Home","text":"|\u001b[1m   famid \u001b[0m|\u001b[1m   perid \u001b[0m|\u001b[1m  faid \u001b[0m|\u001b[1m  moid \u001b[0m|\u001b[1m   sex \u001b[0m|\u001b[1m trait \u001b[0m|\n|\u001b[90m String7 \u001b[0m|\u001b[90m String7 \u001b[0m|\u001b[90m Int64 \u001b[0m|\u001b[90m Int64 \u001b[0m|\u001b[90m Int64 \u001b[0m|\u001b[90m Int64 \u001b[0m|\n|---------|---------|-------|-------|-------|-------|\n|    2431 | NA19916 |     0 |     0 |     1 |     4 |\n|    2424 | NA19835 |     0 |     0 |     2 |     4 |\n|    2469 | NA20282 |     0 |     0 |     2 |     4 |\n|    2368 | NA19703 |     0 |     0 |     1 |     3 |\n|    2425 | NA19901 |     0 |     0 |     2 |     3 |\n|    2427 | NA19908 |     0 |     0 |     1 |     4 |\n|    2430 | NA19914 |     0 |     0 |     2 |     4 |\n|    2470 | NA20287 |     0 |     0 |     2 |     1 |","category":"page"},{"location":"","page":"Home","title":"Home","text":"pretty_table(first(plkfam, 8), tf = tf_markdown)","category":"page"},{"location":"","page":"Home","title":"Home","text":"|\u001b[1m Column1 \u001b[0m|\u001b[1m Column2 \u001b[0m|\u001b[1m Column3 \u001b[0m|\u001b[1m Column4 \u001b[0m|\u001b[1m Column5 \u001b[0m|\u001b[1m Column6 \u001b[0m|\n|\u001b[90m String7 \u001b[0m|\u001b[90m String7 \u001b[0m|\u001b[90m   Int64 \u001b[0m|\u001b[90m   Int64 \u001b[0m|\u001b[90m   Int64 \u001b[0m|\u001b[90m   Int64 \u001b[0m|\n|---------|---------|---------|---------|---------|---------|\n|      A1 | NA19916 |       0 |       0 |       1 |      -9 |\n|       2 | NA19835 |       0 |       0 |       2 |      -9 |\n|       3 | NA20282 |       0 |       0 |       2 |      -9 |\n|       4 | NA19703 |       0 |       0 |       1 |      -9 |\n|       5 | NA19901 |       0 |       0 |       2 |      -9 |\n|       6 | NA19908 |       0 |       0 |       1 |      -9 |\n|       7 | NA19914 |       0 |       0 |       2 |      -9 |\n|       8 | NA20287 |       0 |       0 |       2 |      -9 |","category":"page"},{"location":"#Timing","page":"Home","title":"Timing","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"For this moderate-sized data set, trajgwas takes around 1 second without applying SPA. With SPA, it takes a little longer. ","category":"page"},{"location":"","page":"Home","title":"Home","text":"@btime(trajgwas(@formula(y ~ 1 + sex + onMeds),\n        @formula(y ~ 1),\n        @formula(y ~ 1 + sex + onMeds),\n        :id,\n        datadir * \"trajgwas_plinkex.csv\",\n        datadir * \"hapmap3\",\n        pvalfile = pvalpath,\n        nullfile = nullpath, \n        usespa = false));","category":"page"},{"location":"","page":"Home","title":"Home","text":"run = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.043075\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.038360\nrun = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.042863\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.038349\nrun = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.046263\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.041134\nrun = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.044395\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.040617\nrun = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.046369\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.040637\nrun = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.047622\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.042389\nrun = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.048733\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.042363\nrun = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.057969\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.044363\nrun = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.046105\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.041188\nrun = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.046367\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.040956\nrun = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.045681\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.040467\nrun = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.045576\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.040579\nrun = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.043948\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.039300\nrun = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.045900\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.038610\nrun = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.044771\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.040101\nrun = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.047024\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.039047\nrun = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.043731\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.039392\nrun = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.043643\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.038403\nrun = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.042840\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.038771\nrun = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.044481\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.040184\nrun = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.045463\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.042343\nrun = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.046744\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.041665\nrun = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.043388\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.039299\nrun = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.046229\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.041051\nrun = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.046147\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.042524\nrun = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.047299\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.040978\nrun = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.043347\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.050493\n  468.501 ms (1451269 allocations: 127.54 MiB)","category":"page"},{"location":"","page":"Home","title":"Home","text":"# clean up\nrm(\"trajgwas.null.txt\", force=true)\nrm(\"trajgwas.pval.txt\", force=true)","category":"page"},{"location":"#VCF-Formatted-Files","page":"Home","title":"VCF Formatted Files","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"By default, TrajGWAS.jl will assume you are using PLINK files. It also supports VCF (and BGEN) Files. vcf.gz files are supported as well. To use vcf files in any of the analysis options detailed in this documentation, you simply need to add two keyword options to the trajgwas function:","category":"page"},{"location":"","page":"Home","title":"Home","text":"geneticformat: Choices are \"VCF\" or \"PLINK\". If you are using a VCF file, use geneticformat = \"VCF\".\nvcftype: Choices are :GT (for genotypes) or :DS (for dosages). This tells TrajGWAS which type of data to extract from the VCF file.","category":"page"},{"location":"","page":"Home","title":"Home","text":"Using a VCF File does not output minor allele frequency or hardy weinberg equillibrium p-values for each SNP tested since they may be dosages. ","category":"page"},{"location":"","page":"Home","title":"Home","text":"The following shows how to run an analysis with a VCF file using the dosage information. ","category":"page"},{"location":"","page":"Home","title":"Home","text":"trajgwas(@formula(y ~ 1 + sex + onMeds),\n        @formula(y ~ 1),\n        @formula(y ~ 1 + sex + onMeds),\n        :id,\n        datadir * \"trajgwas_vcfex.csv\",\n        datadir * \"test_vcf\",\n        pvalfile = pvalpath,\n        geneticformat = \"VCF\",\n        vcftype = :DS)","category":"page"},{"location":"","page":"Home","title":"Home","text":"run = 1, ‖Δβ‖ = 0.003459, ‖Δτ‖ = 0.421747, ‖ΔL‖ = 0.002492, status = LOCALLY_SOLVED, time(s) = 0.020269\nrun = 2, ‖Δβ‖ = 0.001369, ‖Δτ‖ = 0.015998, ‖ΔL‖ = 0.003244, status = LOCALLY_SOLVED, time(s) = 0.016583\n\n\n\n\n\n\nWithin-subject variance estimation by robust regression (WiSER)\n\nMean Formula:\ny ~ 1 + sex + onMeds\nRandom Effects Formula:\ny ~ 1\nWithin-Subject Variance Formula:\ny ~ 1 + sex + onMeds\n\nNumber of individuals/clusters: 191\nTotal observations: 1910\n\nFixed-effects parameters:\n────────────────────────────────────────────────────────\n                  Estimate  Std. Error       Z  Pr(>|Z|)\n────────────────────────────────────────────────────────\nβ1: (Intercept)  12.1708     0.18351     66.32    <1e-99\nβ2: sex          -3.41012    0.253155   -13.47    <1e-40\nβ3: onMeds        0.485447   0.0701423    6.92    <1e-11\nτ1: (Intercept)   0.774299   0.0849867    9.11    <1e-19\nτ2: sex          -0.524117   0.106719    -4.91    <1e-06\nτ3: onMeds        0.633337   0.0814974    7.77    <1e-14\n────────────────────────────────────────────────────────\nRandom effects covariance matrix Σγ:\n \"γ1: (Intercept)\"  2.86452","category":"page"},{"location":"","page":"Home","title":"Home","text":"pretty_table(first(CSV.read(\"trajgwas.pval.txt\", DataFrame), 8), tf = tf_markdown)","category":"page"},{"location":"","page":"Home","title":"Home","text":"|\u001b[1m   chr \u001b[0m|\u001b[1m      pos \u001b[0m|\u001b[1m       snpid \u001b[0m|\u001b[1m  betapval \u001b[0m|\u001b[1m betadir \u001b[0m|\u001b[1m    taupval \u001b[0m|\u001b[1m taudir \u001b[0m|\u001b[1m  jointpval \u001b[0m|\n|\u001b[90m Int64 \u001b[0m|\u001b[90m    Int64 \u001b[0m|\u001b[90m    String15 \u001b[0m|\u001b[90m   Float64 \u001b[0m|\u001b[90m   Int64 \u001b[0m|\u001b[90m    Float64 \u001b[0m|\u001b[90m  Int64 \u001b[0m|\u001b[90m    Float64 \u001b[0m|\n|-------|----------|-------------|-----------|---------|------------|--------|------------|\n|    22 | 20000086 | rs138720731 |  0.322684 |      -1 |    0.61956 |     -1 |   0.424353 |\n|    22 | 20000146 |  rs73387790 |       1.0 |       0 |        1.0 |      0 |        1.0 |\n|    22 | 20000199 | rs183293480 |  0.214207 |       1 |   0.190785 |      1 |   0.201819 |\n|    22 | 20000291 | rs185807825 |  0.292231 |       1 |   0.200029 |      1 |   0.237495 |\n|    22 | 20000428 |  rs55902548 | 0.0140114 |       1 | 0.00369005 |      1 | 0.00576184 |\n|    22 | 20000683 | rs142720028 |       1.0 |       0 |        1.0 |      0 |        1.0 |\n|    22 | 20000771 | rs114690707 |  0.536406 |      -1 |   0.145113 |      1 |    0.22843 |\n|    22 | 20000793 | rs189842693 |  0.161414 |      -1 |   0.757017 |      1 |   0.266091 |","category":"page"},{"location":"#BGEN-Formatted-Files","page":"Home","title":"BGEN Formatted Files","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"By default, TrajGWAS.jl will assume you are using PLINK files. It also supports BGEN Files. To use BGEN files in any of the analysis options detailed in this documentation, you simply need to add the following keyword option to the trajgwas function:","category":"page"},{"location":"","page":"Home","title":"Home","text":"geneticformat: Choices are \"VCF\" or \"PLINK\" or \"BGEN\". If you are using a BGEN file, use geneticformat = \"BGEN\".","category":"page"},{"location":"","page":"Home","title":"Home","text":"Using a BGEN File does not output minor allele frequency or hardy weinberg equillibrium p-values for each SNP tested.","category":"page"},{"location":"","page":"Home","title":"Home","text":"Some features, such as SNP-set analyses, are only available when there's an indexing .bgi file available. Additionally, if the BGEN file does not contain sample information (i.e. sample IDs), then a sample file is necessary and its path can be specified with the samplepath keyword. ","category":"page"},{"location":"","page":"Home","title":"Home","text":"note: Note\nBGEN files can contain an optional index file (.bgi file) that allows the variants to be specified in order of position. TrajGWAS will automatically look for a file in the same directory as the BGENFILENAME with the name BGENFILENAME.bgi. The BGEN file is read either in the .bgi file order if BGENFILENAME.bgi is supplied in the same directory as the BGEN file, otherwise it will use the order in the BGEN file. This is important in analyses specifying snpinds as well as annotation groupings. You must make sure this matches the way the BGEN file will be read in. ","category":"page"},{"location":"","page":"Home","title":"Home","text":"The following shows how to run an analysis with a BGEN file using the dosage information. ","category":"page"},{"location":"","page":"Home","title":"Home","text":"trajgwas(@formula(y ~ 1 + sex + onMeds),\n        @formula(y ~ 1),\n        @formula(y ~ 1 + sex + onMeds),\n        :id, \n        datadir * \"trajgwas_bgen_ex.csv\", \n        datadir * \"example.8bits\", \n        geneticformat = \"BGEN\", \n        pvalfile = pvalpath)","category":"page"},{"location":"","page":"Home","title":"Home","text":"run = 1, ‖Δβ‖ = 0.096578, ‖Δτ‖ = 0.162563, ‖ΔL‖ = 0.007625, status = LOCALLY_SOLVED, time(s) = 0.046532\nrun = 2, ‖Δβ‖ = 0.003173, ‖Δτ‖ = 0.005584, ‖ΔL‖ = 0.001468, status = LOCALLY_SOLVED, time(s) = 0.038319\n\n\n\n\n\n\nWithin-subject variance estimation by robust regression (WiSER)\n\nMean Formula:\ny ~ 1 + sex + onMeds\nRandom Effects Formula:\ny ~ 1\nWithin-Subject Variance Formula:\ny ~ 1 + sex + onMeds\n\nNumber of individuals/clusters: 500\nTotal observations: 5000\n\nFixed-effects parameters:\n────────────────────────────────────────────────────────\n                  Estimate  Std. Error       Z  Pr(>|Z|)\n────────────────────────────────────────────────────────\nβ1: (Intercept)  10.5275     0.0992675  106.05    <1e-99\nβ2: sex          -3.38067    0.146416   -23.09    <1e-99\nβ3: onMeds        0.522162   0.0358727   14.56    <1e-47\nτ1: (Intercept)   0.294364   0.0443191    6.64    <1e-10\nτ2: sex          -0.365009   0.0503589   -7.25    <1e-12\nτ3: onMeds        0.559769   0.0467046   11.99    <1e-32\n────────────────────────────────────────────────────────\nRandom effects covariance matrix Σγ:\n \"γ1: (Intercept)\"  2.51561","category":"page"},{"location":"","page":"Home","title":"Home","text":"pretty_table(first(CSV.read(\"trajgwas.pval.txt\", DataFrame), 8), tf = tf_markdown)","category":"page"},{"location":"","page":"Home","title":"Home","text":"|\u001b[1m   chr \u001b[0m|\u001b[1m   pos \u001b[0m|\u001b[1m    snpid \u001b[0m|\u001b[1m     varid \u001b[0m|\u001b[1m  hwepval \u001b[0m|\u001b[1m      maf \u001b[0m|\u001b[1m infoscore \u001b[0m|\u001b[1m    betapval \u001b[0m|\u001b[1m betadir \u001b[0m|\u001b[1m     taupval \u001b[0m|\u001b[1m taudir \u001b[0m|\u001b[1m   jointpval \u001b[0m|\n|\u001b[90m Int64 \u001b[0m|\u001b[90m Int64 \u001b[0m|\u001b[90m String15 \u001b[0m|\u001b[90m  String15 \u001b[0m|\u001b[90m  Float64 \u001b[0m|\u001b[90m  Float64 \u001b[0m|\u001b[90m   Float64 \u001b[0m|\u001b[90m     Float64 \u001b[0m|\u001b[90m   Int64 \u001b[0m|\u001b[90m     Float64 \u001b[0m|\u001b[90m  Int64 \u001b[0m|\u001b[90m     Float64 \u001b[0m|\n|-------|-------|----------|-----------|----------|----------|-----------|-------------|---------|-------------|--------|-------------|\n|     1 |  1001 | RSID_101 | SNPID_101 |  0.86274 | 0.416977 |  0.984639 |    0.510629 |      -1 |    0.425112 |     -1 |    0.463963 |\n|     1 |  2000 |   RSID_2 |   SNPID_2 | 0.192181 |  0.19751 |       9.0 |  4.5062e-10 |       1 | 1.40173e-21 |     -1 | 6.67473e-21 |\n|     1 |  2001 | RSID_102 | SNPID_102 |   0.1844 | 0.197667 |  0.727308 | 4.47847e-10 |      -1 | 1.79121e-21 |      1 | 8.45783e-21 |\n|     1 |  3000 |   RSID_3 |   SNPID_3 | 0.965354 | 0.483396 |  0.955355 |   0.0721822 |      -1 |    0.600949 |     -1 |    0.128884 |\n|     1 |  3001 | RSID_103 | SNPID_103 | 0.965354 | 0.483396 |  0.955355 |   0.0721821 |       1 |    0.600949 |      1 |    0.128884 |\n|     1 |  4000 |   RSID_4 |   SNPID_4 | 0.371927 |  0.21671 |  0.991768 |    0.112472 |      -1 |    0.133752 |     -1 |    0.122192 |\n|     1 |  4001 | RSID_104 | SNPID_104 | 0.371928 |  0.21671 |  0.991768 |    0.112471 |       1 |    0.133752 |      1 |    0.122192 |\n|     1 |  5000 |   RSID_5 |   SNPID_5 | 0.587013 | 0.388082 |  0.968258 |    0.526325 |      -1 |    0.542332 |     -1 |    0.534209 |","category":"page"},{"location":"#SNP-models","page":"Home","title":"SNP models","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"Genotypes are translated into numeric values according to different genetic model, which is specified by the snpmodel keyword. Default is ADDITIVE_MODEL.","category":"page"},{"location":"","page":"Home","title":"Home","text":"Genotype SnpArray ADDITIVE_MODEL DOMINANT_MODEL RECESSIVE_MODEL\nA1,A1 0x00 0 0 0\nmissing 0x01 NaN NaN NaN\nA1,A2 0x02 1 1 0\nA2,A2 0x03 2 1 1","category":"page"},{"location":"","page":"Home","title":"Home","text":"note: Note\ntrajgwas imputes missing genotypes according to minor allele frequencies. ","category":"page"},{"location":"","page":"Home","title":"Home","text":"Users are advised to impute genotypes using more sophiscated methods before GWAS.","category":"page"},{"location":"#SNP-and/or-sample-masks","page":"Home","title":"SNP and/or sample masks","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"In practice, we often perform GWAS on selected SNPs and/or selected samples. They can be specified by the snpinds, covrowinds and geneticrowinds keywords of trajgwas function. ","category":"page"},{"location":"","page":"Home","title":"Home","text":"For example, to perform GWAS on SNPs with minor allele frequency (MAF) above 0.05","category":"page"},{"location":"","page":"Home","title":"Home","text":"# create SNP mask\nsnpinds = maf(SnpArray(\"../data/hapmap3.bed\")) .≥ 0.05\n# GWAS on selected SNPs\n@time trajgwas(@formula(y ~ 1 + sex + onMeds),\n        @formula(y ~ 1),\n        @formula(y ~ 1 + sex + onMeds),\n        :id,\n        datadir * \"trajgwas_plinkex.csv\",\n        datadir * \"hapmap3\",\n        pvalfile = \"commonvariant.pval.txt\",\n        snpinds = snpinds)","category":"page"},{"location":"","page":"Home","title":"Home","text":"run = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.049849\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.053331\n  3.115314 seconds (7.98 M allocations: 489.049 MiB, 3.92% gc time, 65.78% compilation time)\n\n\n\n\n\n\nWithin-subject variance estimation by robust regression (WiSER)\n\nMean Formula:\ny ~ 1 + sex + onMeds\nRandom Effects Formula:\ny ~ 1\nWithin-Subject Variance Formula:\ny ~ 1 + sex + onMeds\n\nNumber of individuals/clusters: 324\nTotal observations: 3240\n\nFixed-effects parameters:\n────────────────────────────────────────────────────────\n                  Estimate  Std. Error       Z  Pr(>|Z|)\n────────────────────────────────────────────────────────\nβ1: (Intercept)  13.2282     0.146459    90.32    <1e-99\nβ2: sex          -3.29295    0.2101     -15.67    <1e-54\nβ3: onMeds        0.459585   0.0596002    7.71    <1e-13\nτ1: (Intercept)   0.792508   0.0850728    9.32    <1e-19\nτ2: sex          -0.2865     0.0970732   -2.95    0.0032\nτ3: onMeds        0.422303   0.063825     6.62    <1e-10\n────────────────────────────────────────────────────────\nRandom effects covariance matrix Σγ:\n \"γ1: (Intercept)\"  3.32057","category":"page"},{"location":"","page":"Home","title":"Home","text":"run(`head commonvariant.pval.txt`);","category":"page"},{"location":"","page":"Home","title":"Home","text":"chr\tpos\tsnpid\tmaf\thwepval\tbetapval\tbetadir\ttaupval\ttaudir\tjointpval\n1\t758311\trs12562034\t0.07763975155279501\t0.4098763332666681\t0.3893898715952268\t-1\t0.9228220976232073\t-1\t0.5476822137398478\n1\t967643\trs2710875\t0.32407407407407407\t4.076249100705747e-7\t5.838562452864651e-6\t1\t3.354075049151666e-6\t-1\t4.935983727867445e-7\n1\t1168108\trs11260566\t0.19158878504672894\t0.1285682279446898\t0.0008508894259509042\t1\t0.05590549977468929\t1\t0.0010182674469333282\n1\t1375074\trs1312568\t0.441358024691358\t2.5376019650614977e-19\t0.00017168324418138014\t-1\t1.8481146312336014e-13\t1\t2.0709090755361924e-15\n1\t1990452\trs2678939\t0.4537037037037037\t5.07695957708431e-11\t1.278709529589261e-7\t1\t7.7380891475822e-9\t-1\t3.3986012947082272e-9\n1\t2194615\trs7553178\t0.22685185185185186\t0.17056143157457776\t0.07404001756940115\t-1\t0.00023109048716816823\t1\t0.00010021413726889922\n1\t2396747\trs13376356\t0.1448598130841121\t0.9053079215078139\t0.48972088680069503\t-1\t0.6595593862223496\t1\t0.5620909278620404\n1\t2823603\trs1563468\t0.4830246913580247\t4.23065537243926e-9\t2.581476982676523e-7\t-1\t1.1700736777037956e-8\t1\t6.36797979359385e-8\n1\t3025087\trs6690373\t0.2538699690402477\t9.238641887192776e-8\t3.111965106232366e-5\t1\t2.0479935907554532e-7\t-1\t2.123094937745341e-5","category":"page"},{"location":"","page":"Home","title":"Home","text":"# extra header line in commonvariant.pval.txt\ncountlines(\"commonvariant.pval.txt\"), count(snpinds)","category":"page"},{"location":"","page":"Home","title":"Home","text":"(12086, 12085)","category":"page"},{"location":"","page":"Home","title":"Home","text":"# clean up\nrm(\"trajgwas.null.txt\", force=true)\nrm(\"commonvariant.pval.txt\", force=true)","category":"page"},{"location":"","page":"Home","title":"Home","text":"covrowinds specify the samples in the covariate file and geneticrowinds for PLINK or VCF File. User should be particularly careful when using these two keyword. Selected rows in SnpArray should exactly match the samples in the null model. Otherwise the results are meaningless.","category":"page"},{"location":"#Estimating-Effect-Sizes-(Wald)","page":"Home","title":"Estimating Effect Sizes (Wald)","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"By default, trajgwas calculates p-value for each SNP using SPA/score test. Score test is fast because it doesn't require fitting alternative model for each SNP. User can request the Wald p-values and the estimated effect size of each SNP using keyword test=:wald. Wald is much slower but will give you estimated effect sizes from the WiSER model.","category":"page"},{"location":"","page":"Home","title":"Home","text":"@time trajgwas(@formula(y ~ 1 + sex + onMeds),\n        @formula(y ~ 1),\n        @formula(y ~ 1 + sex + onMeds),\n        :id,\n        datadir * \"trajgwas_plinkex.csv\",\n        datadir * \"hapmap3\",\n        pvalfile = \"wald.pval.txt\",\n        snpinds = 1:5,\n        test = :wald)","category":"page"},{"location":"","page":"Home","title":"Home","text":"run = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.045384\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.043791\nrun = 1, ‖Δβ‖ = 0.033243, ‖Δτ‖ = 0.146511, ‖ΔL‖ = 0.005476, status = LOCALLY_SOLVED, time(s) = 0.051594\nrun = 2, ‖Δβ‖ = 0.005774, ‖Δτ‖ = 0.042246, ‖ΔL‖ = 0.001784, status = LOCALLY_SOLVED, time(s) = 0.046967\nrun = 1, ‖Δβ‖ = 0.013090, ‖Δτ‖ = 0.130781, ‖ΔL‖ = 0.005011, status = LOCALLY_SOLVED, time(s) = 0.056558\nrun = 2, ‖Δβ‖ = 0.003913, ‖Δτ‖ = 0.037309, ‖ΔL‖ = 0.001516, status = LOCALLY_SOLVED, time(s) = 0.051369\nrun = 1, ‖Δβ‖ = 0.022159, ‖Δτ‖ = 0.141135, ‖ΔL‖ = 0.005554, status = LOCALLY_SOLVED, time(s) = 0.048028\nrun = 2, ‖Δβ‖ = 0.001482, ‖Δτ‖ = 0.021700, ‖ΔL‖ = 0.001435, status = LOCALLY_SOLVED, time(s) = 0.043137\nrun = 1, ‖Δβ‖ = 0.026764, ‖Δτ‖ = 0.368620, ‖ΔL‖ = 0.000317, status = LOCALLY_SOLVED, time(s) = 0.047566\nrun = 2, ‖Δβ‖ = 0.003023, ‖Δτ‖ = 0.030938, ‖ΔL‖ = 0.003568, status = LOCALLY_SOLVED, time(s) = 0.042606\n  7.188892 seconds (12.73 M allocations: 777.569 MiB, 3.41% gc time, 91.29% compilation time)\n\n\n\n\n\n\nWithin-subject variance estimation by robust regression (WiSER)\n\nMean Formula:\ny ~ 1 + sex + onMeds\nRandom Effects Formula:\ny ~ 1\nWithin-Subject Variance Formula:\ny ~ 1 + sex + onMeds\n\nNumber of individuals/clusters: 324\nTotal observations: 3240\n\nFixed-effects parameters:\n────────────────────────────────────────────────────────\n                  Estimate  Std. Error       Z  Pr(>|Z|)\n────────────────────────────────────────────────────────\nβ1: (Intercept)  13.2282     0.146459    90.32    <1e-99\nβ2: sex          -3.29295    0.2101     -15.67    <1e-54\nβ3: onMeds        0.459585   0.0596002    7.71    <1e-13\nτ1: (Intercept)   0.792508   0.0850728    9.32    <1e-19\nτ2: sex          -0.2865     0.0970732   -2.95    0.0032\nτ3: onMeds        0.422303   0.063825     6.62    <1e-10\n────────────────────────────────────────────────────────\nRandom effects covariance matrix Σγ:\n \"γ1: (Intercept)\"  3.32057","category":"page"},{"location":"","page":"Home","title":"Home","text":"Note the extra effect column in pvalfile, which is the effect size (regression coefficient) for each SNP. ","category":"page"},{"location":"","page":"Home","title":"Home","text":"run(`head wald.pval.txt`);","category":"page"},{"location":"","page":"Home","title":"Home","text":"chr\tpos\tsnpid\tmaf\thwepval\tbetaeffect\tbetapval\ttaueffect\ttaupval\n1\t554484\trs10458597\t0.0\t1.0\t0.0\t1.0\t0.0\t1.0\n1\t758311\trs12562034\t0.07763975155279501\t0.4098763332666681\t-0.231072479332816\t0.3929844692486013\t0.01340575997086949\t0.9216488777690096\n1\t967643\trs2710875\t0.32407407407407407\t4.076249100705747e-7\t0.6406954913590558\t8.824209286611495e-7\t-0.34763283794106525\t1.0836367479719384e-11\n1\t1168108\trs11260566\t0.19158878504672894\t0.1285682279446898\t0.6188250819875118\t0.0002537468407208455\t-0.14748437551458396\t0.0502802758129169\n1\t1375074\trs1312568\t0.441358024691358\t2.5376019650614977e-19\t-0.4560323801786057\t0.00016592110001810087\t0.4964521486169327\t1.177346561221082e-36","category":"page"},{"location":"","page":"Home","title":"Home","text":"One may disable within-sample variability modeling by putting a keyword argument disable_wsvar=true.  ","category":"page"},{"location":"","page":"Home","title":"Home","text":"@time trajgwas(@formula(y ~ 1 + sex + onMeds),\n        @formula(y ~ 1),\n        @formula(y ~ 1 + sex + onMeds),\n        :id,\n        datadir * \"trajgwas_plinkex.csv\",\n        datadir * \"hapmap3\",\n        pvalfile = \"wald.pval.txt\",\n        snpinds = 1:5,\n        test = :wald,\ndisable_wsvar = true)","category":"page"},{"location":"","page":"Home","title":"Home","text":"run = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.043700\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.038386\nrun = 1, ‖Δβ‖ = 0.034186, ‖Δτ‖ = 0.147419, ‖ΔL‖ = 0.005538, status = LOCALLY_SOLVED, time(s) = 0.043628\nrun = 2, ‖Δβ‖ = 0.006293, ‖Δτ‖ = 0.021529, ‖ΔL‖ = 0.001733, status = LOCALLY_SOLVED, time(s) = 0.038884\nrun = 1, ‖Δβ‖ = 0.007322, ‖Δτ‖ = 0.107654, ‖ΔL‖ = 0.004949, status = LOCALLY_SOLVED, time(s) = 0.043276\nrun = 2, ‖Δβ‖ = 0.001662, ‖Δτ‖ = 0.013700, ‖ΔL‖ = 0.001501, status = LOCALLY_SOLVED, time(s) = 0.038970\nrun = 1, ‖Δβ‖ = 0.021644, ‖Δτ‖ = 0.134147, ‖ΔL‖ = 0.005351, status = LOCALLY_SOLVED, time(s) = 0.043053\nrun = 2, ‖Δβ‖ = 0.001608, ‖Δτ‖ = 0.019473, ‖ΔL‖ = 0.001570, status = LOCALLY_SOLVED, time(s) = 0.050367\nrun = 1, ‖Δβ‖ = 0.017117, ‖Δτ‖ = 0.154749, ‖ΔL‖ = 0.005408, status = LOCALLY_SOLVED, time(s) = 0.047992\nrun = 2, ‖Δβ‖ = 0.000453, ‖Δτ‖ = 0.023558, ‖ΔL‖ = 0.001218, status = LOCALLY_SOLVED, time(s) = 0.042605\n  4.148354 seconds (9.69 M allocations: 605.898 MiB, 4.13% gc time, 86.93% compilation time)\n\n\n\n\n\n\nWithin-subject variance estimation by robust regression (WiSER)\n\nMean Formula:\ny ~ 1 + sex + onMeds\nRandom Effects Formula:\ny ~ 1\nWithin-Subject Variance Formula:\ny ~ 1 + sex + onMeds\n\nNumber of individuals/clusters: 324\nTotal observations: 3240\n\nFixed-effects parameters:\n────────────────────────────────────────────────────────\n                  Estimate  Std. Error       Z  Pr(>|Z|)\n────────────────────────────────────────────────────────\nβ1: (Intercept)  13.2282     0.146459    90.32    <1e-99\nβ2: sex          -3.29295    0.2101     -15.67    <1e-54\nβ3: onMeds        0.459585   0.0596002    7.71    <1e-13\nτ1: (Intercept)   0.792508   0.0850728    9.32    <1e-19\nτ2: sex          -0.2865     0.0970732   -2.95    0.0032\nτ3: onMeds        0.422303   0.063825     6.62    <1e-10\n────────────────────────────────────────────────────────\nRandom effects covariance matrix Σγ:\n \"γ1: (Intercept)\"  3.32057","category":"page"},{"location":"","page":"Home","title":"Home","text":"run(`head wald.pval.txt`);","category":"page"},{"location":"","page":"Home","title":"Home","text":"chr\tpos\tsnpid\tmaf\thwepval\tbetaeffect\tbetapval\n1\t554484\trs10458597\t0.0\t1.0\t0.0\t1.0\n1\t758311\trs12562034\t0.07763975155279501\t0.4098763332666681\t-0.23114605301396765\t0.3929413858489548\n1\t967643\trs2710875\t0.32407407407407407\t4.076249100705747e-7\t0.6357974571413716\t1.02417981478764e-6\n1\t1168108\trs11260566\t0.19158878504672894\t0.1285682279446898\t0.6188324923086607\t0.0002473977473431405\n1\t1375074\trs1312568\t0.441358024691358\t2.5376019650614977e-19\t-0.45677365058013597\t0.0001627044523523231","category":"page"},{"location":"","page":"Home","title":"Home","text":"# clean up\nrm(\"wald.pval.txt\", force=true)\nrm(\"trajgwas.null.txt\", force=true)","category":"page"},{"location":"#Score-test-for-screening,-Wald-for-effect-size-estimates","page":"Home","title":"Score test for screening, Wald for effect size estimates","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"For large data sets, a practical solution is to perform the score test first across all SNPs, then re-do Wald for the most promising SNPs according to score test p-values in order to get estimated effect sizes.","category":"page"},{"location":"","page":"Home","title":"Home","text":"Step 1: Perform score test GWAS, results in score.pval.txt.","category":"page"},{"location":"","page":"Home","title":"Home","text":"@time trajgwas(@formula(y ~ 1 + sex + onMeds),\n        @formula(y ~ 1),\n        @formula(y ~ 1 + sex + onMeds),\n        :id,\n        datadir * \"trajgwas_plinkex.csv\",\n        datadir * \"hapmap3\",\n        pvalfile = \"score.pval.txt\")","category":"page"},{"location":"","page":"Home","title":"Home","text":"run = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.043247\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.038263\n  1.090987 seconds (4.02 M allocations: 259.292 MiB, 12.06% gc time)\n\n\n\n\n\n\nWithin-subject variance estimation by robust regression (WiSER)\n\nMean Formula:\ny ~ 1 + sex + onMeds\nRandom Effects Formula:\ny ~ 1\nWithin-Subject Variance Formula:\ny ~ 1 + sex + onMeds\n\nNumber of individuals/clusters: 324\nTotal observations: 3240\n\nFixed-effects parameters:\n────────────────────────────────────────────────────────\n                  Estimate  Std. Error       Z  Pr(>|Z|)\n────────────────────────────────────────────────────────\nβ1: (Intercept)  13.2282     0.146459    90.32    <1e-99\nβ2: sex          -3.29295    0.2101     -15.67    <1e-54\nβ3: onMeds        0.459585   0.0596002    7.71    <1e-13\nτ1: (Intercept)   0.792508   0.0850728    9.32    <1e-19\nτ2: sex          -0.2865     0.0970732   -2.95    0.0032\nτ3: onMeds        0.422303   0.063825     6.62    <1e-10\n────────────────────────────────────────────────────────\nRandom effects covariance matrix Σγ:\n \"γ1: (Intercept)\"  3.32057","category":"page"},{"location":"","page":"Home","title":"Home","text":"pretty_table(first(CSV.read(\"score.pval.txt\", DataFrame), 8), tf = tf_markdown)","category":"page"},{"location":"","page":"Home","title":"Home","text":"|\u001b[1m   chr \u001b[0m|\u001b[1m     pos \u001b[0m|\u001b[1m      snpid \u001b[0m|\u001b[1m        maf \u001b[0m|\u001b[1m     hwepval \u001b[0m|\u001b[1m    betapval \u001b[0m|\u001b[1m betadir \u001b[0m|\u001b[1m     taupval \u001b[0m|\u001b[1m taudir \u001b[0m|\u001b[1m   jointpval \u001b[0m|\n|\u001b[90m Int64 \u001b[0m|\u001b[90m   Int64 \u001b[0m|\u001b[90m   String31 \u001b[0m|\u001b[90m    Float64 \u001b[0m|\u001b[90m     Float64 \u001b[0m|\u001b[90m     Float64 \u001b[0m|\u001b[90m   Int64 \u001b[0m|\u001b[90m     Float64 \u001b[0m|\u001b[90m  Int64 \u001b[0m|\u001b[90m     Float64 \u001b[0m|\n|-------|---------|------------|------------|-------------|-------------|---------|-------------|--------|-------------|\n|     1 |  554484 | rs10458597 |        0.0 |         1.0 |         1.0 |       0 |         1.0 |      0 |         1.0 |\n|     1 |  758311 | rs12562034 |  0.0776398 |    0.409876 |     0.38939 |      -1 |    0.922822 |     -1 |    0.547682 |\n|     1 |  967643 |  rs2710875 |   0.324074 |  4.07625e-7 |  5.83856e-6 |       1 |  3.35408e-6 |     -1 |  4.93598e-7 |\n|     1 | 1168108 | rs11260566 |   0.191589 |    0.128568 | 0.000850889 |       1 |   0.0559055 |      1 |  0.00101827 |\n|     1 | 1375074 |  rs1312568 |   0.441358 |  2.5376e-19 | 0.000171683 |      -1 | 1.84811e-13 |      1 | 2.07091e-15 |\n|     1 | 1588771 | rs35154105 |        0.0 |         1.0 |         1.0 |       0 |         1.0 |      0 |         1.0 |\n|     1 | 1789051 | rs16824508 | 0.00462963 |    0.933278 |    0.295035 |       1 |    0.304109 |      1 |    0.299504 |\n|     1 | 1990452 |  rs2678939 |   0.453704 | 5.07696e-11 |  1.27871e-7 |       1 |  7.73809e-9 |     -1 |   3.3986e-9 |","category":"page"},{"location":"","page":"Home","title":"Home","text":"Step 2: Sort score test p-values and find top 10 SNPs.","category":"page"},{"location":"","page":"Home","title":"Home","text":"scorepvals = CSV.read(\"score.pval.txt\", DataFrame)[!, :taupval] # tau p-values \ntophits = sortperm(scorepvals)[1:10] # indices of 10 SNPs with smallest p-values\nscorepvals[tophits] # smallest 10 p-values","category":"page"},{"location":"","page":"Home","title":"Home","text":"10-element Vector{Float64}:\n 7.872202557706978e-17\n 1.8481146312336014e-13\n 1.497868141369434e-12\n 9.730062616490452e-12\n 1.2892059340654512e-11\n 1.4844638660225815e-11\n 1.5167114834215392e-11\n 1.8761256218261456e-11\n 2.3491352960094672e-11\n 2.6075629334507108e-11","category":"page"},{"location":"","page":"Home","title":"Home","text":"Step 3: Re-do LRT on top hits.","category":"page"},{"location":"","page":"Home","title":"Home","text":"@time trajgwas(@formula(y ~ 1 + sex + onMeds),\n        @formula(y ~ 1),\n        @formula(y ~ 1 + sex + onMeds),\n        :id,\n        datadir * \"trajgwas_plinkex.csv\",\n        datadir * \"hapmap3\",\n        pvalfile = \"wald.pval.txt\",\n        snpinds = tophits,\n        test = :wald)","category":"page"},{"location":"","page":"Home","title":"Home","text":"run = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.044230\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.041163\nrun = 1, ‖Δβ‖ = 0.026764, ‖Δτ‖ = 0.368620, ‖ΔL‖ = 0.000317, status = LOCALLY_SOLVED, time(s) = 0.058660\nrun = 2, ‖Δβ‖ = 0.003023, ‖Δτ‖ = 0.030938, ‖ΔL‖ = 0.003568, status = LOCALLY_SOLVED, time(s) = 0.047351\nrun = 1, ‖Δβ‖ = 0.039946, ‖Δτ‖ = 0.185049, ‖ΔL‖ = 0.005690, status = LOCALLY_SOLVED, time(s) = 0.050856\nrun = 2, ‖Δβ‖ = 0.001640, ‖Δτ‖ = 0.029639, ‖ΔL‖ = 0.002028, status = LOCALLY_SOLVED, time(s) = 0.046967\nrun = 1, ‖Δβ‖ = 0.040207, ‖Δτ‖ = 0.407863, ‖ΔL‖ = 0.001924, status = LOCALLY_SOLVED, time(s) = 0.047495\nrun = 2, ‖Δβ‖ = 0.002632, ‖Δτ‖ = 0.039609, ‖ΔL‖ = 0.005131, status = LOCALLY_SOLVED, time(s) = 0.047358\nrun = 1, ‖Δβ‖ = 0.052372, ‖Δτ‖ = 0.828946, ‖ΔL‖ = 0.001277, status = LOCALLY_SOLVED, time(s) = 0.062142\nrun = 2, ‖Δβ‖ = 0.013694, ‖Δτ‖ = 0.185493, ‖ΔL‖ = 0.007118, status = LOCALLY_SOLVED, time(s) = 0.057363\nrun = 1, ‖Δβ‖ = 0.032435, ‖Δτ‖ = 0.199659, ‖ΔL‖ = 0.004973, status = LOCALLY_SOLVED, time(s) = 0.050019\nrun = 2, ‖Δβ‖ = 0.002847, ‖Δτ‖ = 0.032438, ‖ΔL‖ = 0.002941, status = LOCALLY_SOLVED, time(s) = 0.074352\nrun = 1, ‖Δβ‖ = 0.009362, ‖Δτ‖ = 0.625969, ‖ΔL‖ = 0.002237, status = LOCALLY_SOLVED, time(s) = 0.079848\nrun = 2, ‖Δβ‖ = 0.005893, ‖Δτ‖ = 0.176417, ‖ΔL‖ = 0.005017, status = LOCALLY_SOLVED, time(s) = 0.057973\nrun = 1, ‖Δβ‖ = 0.012805, ‖Δτ‖ = 0.243313, ‖ΔL‖ = 0.006289, status = LOCALLY_SOLVED, time(s) = 0.056301\nrun = 2, ‖Δβ‖ = 0.002636, ‖Δτ‖ = 0.044210, ‖ΔL‖ = 0.003312, status = LOCALLY_SOLVED, time(s) = 0.060641\nrun = 1, ‖Δβ‖ = 0.014062, ‖Δτ‖ = 0.225841, ‖ΔL‖ = 0.003899, status = LOCALLY_SOLVED, time(s) = 0.061649\nrun = 2, ‖Δβ‖ = 0.002112, ‖Δτ‖ = 0.030955, ‖ΔL‖ = 0.003860, status = LOCALLY_SOLVED, time(s) = 0.053257\nrun = 1, ‖Δβ‖ = 0.026425, ‖Δτ‖ = 0.258805, ‖ΔL‖ = 0.004204, status = LOCALLY_SOLVED, time(s) = 0.060798\nrun = 2, ‖Δβ‖ = 0.001090, ‖Δτ‖ = 0.051281, ‖ΔL‖ = 0.003822, status = LOCALLY_SOLVED, time(s) = 0.059465\nrun = 1, ‖Δβ‖ = 0.035737, ‖Δτ‖ = 0.174702, ‖ΔL‖ = 0.001439, status = LOCALLY_SOLVED, time(s) = 0.063468\nrun = 2, ‖Δβ‖ = 0.004776, ‖Δτ‖ = 0.019790, ‖ΔL‖ = 0.001867, status = LOCALLY_SOLVED, time(s) = 0.064655\n  3.802703 seconds (7.04 M allocations: 458.754 MiB, 3.72% gc time, 60.82% compilation time)\n\n\n\n\n\n\nWithin-subject variance estimation by robust regression (WiSER)\n\nMean Formula:\ny ~ 1 + sex + onMeds\nRandom Effects Formula:\ny ~ 1\nWithin-Subject Variance Formula:\ny ~ 1 + sex + onMeds\n\nNumber of individuals/clusters: 324\nTotal observations: 3240\n\nFixed-effects parameters:\n────────────────────────────────────────────────────────\n                  Estimate  Std. Error       Z  Pr(>|Z|)\n────────────────────────────────────────────────────────\nβ1: (Intercept)  13.2282     0.146459    90.32    <1e-99\nβ2: sex          -3.29295    0.2101     -15.67    <1e-54\nβ3: onMeds        0.459585   0.0596002    7.71    <1e-13\nτ1: (Intercept)   0.792508   0.0850728    9.32    <1e-19\nτ2: sex          -0.2865     0.0970732   -2.95    0.0032\nτ3: onMeds        0.422303   0.063825     6.62    <1e-10\n────────────────────────────────────────────────────────\nRandom effects covariance matrix Σγ:\n \"γ1: (Intercept)\"  3.32057","category":"page"},{"location":"","page":"Home","title":"Home","text":"pretty_table(CSV.read(\"wald.pval.txt\", DataFrame), tf = tf_markdown)","category":"page"},{"location":"","page":"Home","title":"Home","text":"|\u001b[1m   chr \u001b[0m|\u001b[1m       pos \u001b[0m|\u001b[1m     snpid \u001b[0m|\u001b[1m      maf \u001b[0m|\u001b[1m     hwepval \u001b[0m|\u001b[1m betaeffect \u001b[0m|\u001b[1m    betapval \u001b[0m|\u001b[1m taueffect \u001b[0m|\u001b[1m     taupval \u001b[0m|\n|\u001b[90m Int64 \u001b[0m|\u001b[90m     Int64 \u001b[0m|\u001b[90m  String15 \u001b[0m|\u001b[90m  Float64 \u001b[0m|\u001b[90m     Float64 \u001b[0m|\u001b[90m    Float64 \u001b[0m|\u001b[90m     Float64 \u001b[0m|\u001b[90m   Float64 \u001b[0m|\u001b[90m     Float64 \u001b[0m|\n|-------|-----------|-----------|----------|-------------|------------|-------------|-----------|-------------|\n|     1 |   1375074 | rs1312568 | 0.441358 |  2.5376e-19 |  -0.456032 | 0.000165921 |  0.496452 | 1.17735e-36 |\n|     1 |  11552817 | rs2745282 | 0.421053 |  1.3537e-14 |   -0.67282 |   7.6492e-9 |  0.425653 | 1.45395e-19 |\n|     1 | 120276030 | rs6688004 | 0.469136 | 1.75473e-27 |  -0.637817 |  5.13062e-9 |  0.430562 | 6.07457e-21 |\n|     2 | 135623558 | rs6730157 | 0.313272 | 7.76753e-16 |  -0.556166 |  1.10163e-5 |  0.462346 | 2.88628e-20 |\n|     9 | 126307510 | rs3814134 | 0.427469 | 4.28276e-33 |   0.723472 | 1.41601e-11 | -0.518216 | 4.75338e-39 |\n|    15 |  40603025 | rs2617236 | 0.390966 | 1.16466e-14 |  -0.644375 |  1.44948e-7 |  0.445647 | 9.43451e-19 |\n|    15 |  40803767 | rs3742988 |  0.42284 | 4.26181e-30 |  -0.796743 | 2.24785e-13 |  0.389234 | 7.09349e-17 |\n|    17 |  56509992 | rs8064681 | 0.481481 | 1.37485e-21 |   -0.58961 |   1.9256e-7 |  0.425417 | 5.60171e-25 |\n|    17 |  71293786 | rs2125345 | 0.339009 | 1.75527e-14 |  -0.635669 |  1.82739e-7 |  0.449612 |  1.7146e-21 |\n|    23 |  64815688 | rs5964999 | 0.475078 | 3.63212e-56 |    0.75886 | 5.04109e-14 |  -0.38849 | 5.39098e-23 |","category":"page"},{"location":"","page":"Home","title":"Home","text":"# clean up\nrm(\"trajgwas.null.txt\", force=true)\nrm(\"trajgwas.pval.txt\", force=true)\nrm(\"score.pval.txt\", force=true)\nrm(\"wald.pval.txt\", force=true)","category":"page"},{"location":"#GxE-or-other-interactions","page":"Home","title":"GxE or other interactions","text":"","category":"section"},{"location":"#Testing-jointly-G-GxE","page":"Home","title":"Testing jointly G + GxE","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"In many applications, we want to test SNP effect and/or its interaction with other terms. testformula keyword specifies the test unit besides the covariates in nullformula. ","category":"page"},{"location":"","page":"Home","title":"Home","text":"In following example, keyword testformula=@formula(y ~ snp + snp & sex) instructs trajgwas to test joint effect of snp and snp & sex interaction.","category":"page"},{"location":"","page":"Home","title":"Home","text":"trajgwas(@formula(y ~ 1 + sex + onMeds),\n        @formula(y ~ 1),\n        @formula(y ~ 1 + sex + onMeds),\n        :id,\n        datadir * \"trajgwas_plinkex.csv\",\n        datadir * \"hapmap3\",\n        pvalfile = \"GxE.pval.txt\",\n        testformula=@formula(y ~ snp + snp & sex))","category":"page"},{"location":"","page":"Home","title":"Home","text":"run = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.054691\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.050742\n\n\n\n\n\n\nWithin-subject variance estimation by robust regression (WiSER)\n\nMean Formula:\ny ~ 1 + sex + onMeds\nRandom Effects Formula:\ny ~ 1\nWithin-Subject Variance Formula:\ny ~ 1 + sex + onMeds\n\nNumber of individuals/clusters: 324\nTotal observations: 3240\n\nFixed-effects parameters:\n────────────────────────────────────────────────────────\n                  Estimate  Std. Error       Z  Pr(>|Z|)\n────────────────────────────────────────────────────────\nβ1: (Intercept)  13.2282     0.146459    90.32    <1e-99\nβ2: sex          -3.29295    0.2101     -15.67    <1e-54\nβ3: onMeds        0.459585   0.0596002    7.71    <1e-13\nτ1: (Intercept)   0.792508   0.0850728    9.32    <1e-19\nτ2: sex          -0.2865     0.0970732   -2.95    0.0032\nτ3: onMeds        0.422303   0.063825     6.62    <1e-10\n────────────────────────────────────────────────────────\nRandom effects covariance matrix Σγ:\n \"γ1: (Intercept)\"  3.32057","category":"page"},{"location":"","page":"Home","title":"Home","text":"pretty_table(first(CSV.read(\"GxE.pval.txt\", DataFrame), 5), tf = tf_markdown)","category":"page"},{"location":"","page":"Home","title":"Home","text":"|\u001b[1m   chr \u001b[0m|\u001b[1m     pos \u001b[0m|\u001b[1m      snpid \u001b[0m|\u001b[1m       maf \u001b[0m|\u001b[1m    hwepval \u001b[0m|\u001b[1m    betapval \u001b[0m|\u001b[1m     taupval \u001b[0m|\u001b[1m   jointpval \u001b[0m|\n|\u001b[90m Int64 \u001b[0m|\u001b[90m   Int64 \u001b[0m|\u001b[90m   String31 \u001b[0m|\u001b[90m   Float64 \u001b[0m|\u001b[90m    Float64 \u001b[0m|\u001b[90m     Float64 \u001b[0m|\u001b[90m     Float64 \u001b[0m|\u001b[90m     Float64 \u001b[0m|\n|-------|---------|------------|-----------|------------|-------------|-------------|-------------|\n|     1 |  554484 | rs10458597 |       0.0 |        1.0 |         1.0 |         1.0 |         1.0 |\n|     1 |  758311 | rs12562034 | 0.0776398 |   0.409876 |       0.383 |     0.33511 |    0.357458 |\n|     1 |  967643 |  rs2710875 |  0.324074 | 4.07625e-7 |  9.98217e-6 |  5.73202e-7 |  1.08415e-6 |\n|     1 | 1168108 | rs11260566 |  0.191589 |   0.128568 |  0.00225789 |    0.105482 |  0.00442114 |\n|     1 | 1375074 |  rs1312568 |  0.441358 | 2.5376e-19 | 0.000928728 | 3.48807e-15 | 6.97615e-15 |","category":"page"},{"location":"","page":"Home","title":"Home","text":"# clean up\nrm(\"trajgwas.null.txt\", force=true)\nrm(\"GxE.pval.txt\",  force=true)","category":"page"},{"location":"#Testing-only-GxE-interaction-term","page":"Home","title":"Testing only GxE interaction term","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"For some applications, the user may want to simply test the GxE interaction effect. This requires fitting the SNP in the null model and is much slower, but the command trajgwas() with keyword analysistype = \"gxe\" can be used test the interaction effect. The environmental variable must be specified in the command using the keyword argument e, either as a symbol, such as :age or as a string \"age\". ","category":"page"},{"location":"","page":"Home","title":"Home","text":"trajgwas(@formula(y ~ 1 + sex + onMeds),\n        @formula(y ~ 1),\n        @formula(y ~ 1 + sex + onMeds),\n        :id,\n        datadir * \"trajgwas_plinkex.csv\",\n        datadir * \"hapmap3\",\n        pvalfile = \"gxe_snp.pval.txt\", \n        analysistype = \"gxe\",\n        e = :sex, \n        snpinds=1:5)\n","category":"page"},{"location":"","page":"Home","title":"Home","text":"run = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.052487\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.046791\nrun = 1, ‖Δβ‖ = 0.480377, ‖Δτ‖ = 0.023510, ‖ΔL‖ = 0.001822, status = LOCALLY_SOLVED, time(s) = 0.045053\nrun = 2, ‖Δβ‖ = 0.000323, ‖Δτ‖ = 0.002136, ‖ΔL‖ = 0.000025, status = LOCALLY_SOLVED, time(s) = 0.050111\nrun = 1, ‖Δβ‖ = 1.059989, ‖Δτ‖ = 0.458239, ‖ΔL‖ = 0.063093, status = LOCALLY_SOLVED, time(s) = 0.064015\nrun = 2, ‖Δβ‖ = 0.009118, ‖Δτ‖ = 0.105352, ‖ΔL‖ = 0.000056, status = LOCALLY_SOLVED, time(s) = 0.058007\nrun = 1, ‖Δβ‖ = 1.144781, ‖Δτ‖ = 0.251459, ‖ΔL‖ = 0.034318, status = LOCALLY_SOLVED, time(s) = 0.049777\nrun = 2, ‖Δβ‖ = 0.000830, ‖Δτ‖ = 0.025631, ‖ΔL‖ = 0.000042, status = LOCALLY_SOLVED, time(s) = 0.044902\nrun = 1, ‖Δβ‖ = 0.683108, ‖Δτ‖ = 0.773919, ‖ΔL‖ = 0.042397, status = LOCALLY_SOLVED, time(s) = 0.045594\nrun = 2, ‖Δβ‖ = 0.008159, ‖Δτ‖ = 0.069178, ‖ΔL‖ = 0.003574, status = LOCALLY_SOLVED, time(s) = 0.053428\n\n\n\n\n\n\nWithin-subject variance estimation by robust regression (WiSER)\n\nMean Formula:\ny ~ 1 + sex + onMeds\nRandom Effects Formula:\ny ~ 1\nWithin-Subject Variance Formula:\ny ~ 1 + sex + onMeds\n\nNumber of individuals/clusters: 324\nTotal observations: 3240\n\nFixed-effects parameters:\n────────────────────────────────────────────────────────\n                  Estimate  Std. Error       Z  Pr(>|Z|)\n────────────────────────────────────────────────────────\nβ1: (Intercept)  13.2282     0.146459    90.32    <1e-99\nβ2: sex          -3.29295    0.2101     -15.67    <1e-54\nβ3: onMeds        0.459585   0.0596002    7.71    <1e-13\nτ1: (Intercept)   0.792508   0.0850728    9.32    <1e-19\nτ2: sex          -0.2865     0.0970732   -2.95    0.0032\nτ3: onMeds        0.422303   0.063825     6.62    <1e-10\n────────────────────────────────────────────────────────\nRandom effects covariance matrix Σγ:\n \"γ1: (Intercept)\"  3.32057","category":"page"},{"location":"","page":"Home","title":"Home","text":"pretty_table(CSV.read(\"gxe_snp.pval.txt\", DataFrame), tf = tf_markdown)","category":"page"},{"location":"","page":"Home","title":"Home","text":"|\u001b[1m   chr \u001b[0m|\u001b[1m     pos \u001b[0m|\u001b[1m      snpid \u001b[0m|\u001b[1m       maf \u001b[0m|\u001b[1m    hwepval \u001b[0m|\u001b[1m snpeffectnullbeta \u001b[0m|\u001b[1m snpeffectnulltau \u001b[0m|\u001b[1m betapval \u001b[0m|\u001b[1m  taupval \u001b[0m|\n|\u001b[90m Int64 \u001b[0m|\u001b[90m   Int64 \u001b[0m|\u001b[90m   String15 \u001b[0m|\u001b[90m   Float64 \u001b[0m|\u001b[90m    Float64 \u001b[0m|\u001b[90m           Float64 \u001b[0m|\u001b[90m          Float64 \u001b[0m|\u001b[90m  Float64 \u001b[0m|\u001b[90m  Float64 \u001b[0m|\n|-------|---------|------------|-----------|------------|-------------------|------------------|----------|----------|\n|     1 |  554484 | rs10458597 |       0.0 |        1.0 |               0.0 |              0.0 |      1.0 |      1.0 |\n|     1 |  758311 | rs12562034 | 0.0776398 |   0.409876 |         -0.230593 |        0.0102355 | 0.448376 | 0.149797 |\n|     1 |  967643 |  rs2710875 |  0.324074 | 4.07625e-7 |          0.639871 |        -0.338815 | 0.293876 | 0.119916 |\n|     1 | 1168108 | rs11260566 |  0.191589 |   0.128568 |          0.618855 |        -0.146819 | 0.590189 | 0.262791 |\n|     1 | 1375074 |  rs1312568 |  0.441358 | 2.5376e-19 |         -0.456003 |         0.492582 | 0.574737 | 0.250501 |","category":"page"},{"location":"","page":"Home","title":"Home","text":"# clean up\nrm(\"trajgwas.null.txt\", force=true)\nrm(\"gxe_snp.pval.txt\", force=true)","category":"page"},{"location":"#SNP-set-testing","page":"Home","title":"SNP-set testing","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"In many applications, we want to test a SNP-set. The function with keyword analysistype = \"snpset\" can be used to do this. To specify the type of snpset test, use the snpset keyword argument. ","category":"page"},{"location":"","page":"Home","title":"Home","text":"The snpset can be specified as either:","category":"page"},{"location":"","page":"Home","title":"Home","text":"a window (test every X snps) => snpset = X\nan annotated file.  This requires snpset = filename where filename is an input file, with no header and two columns separated by a space. The first column must contain the snpset ID and the second column must contain the snpid's (rsid) identical to the bimfile, or in the case of a BGEN format, the order the data will be read (see BGEN above for more details).\na joint test on only a specific set of snps. snpset = AbstractVector where the vector specifies the snps you want to perform one joint snpset test for. The vector can either be a vector of integers where the elements are the indicies of the SNPs to test, a vector of booleans, where true represents that you want to select that SNP index, or a range indicating the indicies of the SNPs to test. ","category":"page"},{"location":"","page":"Home","title":"Home","text":"SNPset testing is currently only implemented for the score test (not Wald). ","category":"page"},{"location":"","page":"Home","title":"Home","text":"In the following example, we perform a SNP-set test on the 50th to 55th snps. ","category":"page"},{"location":"","page":"Home","title":"Home","text":"trajgwas(@formula(y ~ 1 + sex + onMeds),\n        @formula(y ~ 1),\n        @formula(y ~ 1 + sex + onMeds),\n        :id,\n        datadir * \"trajgwas_plinkex.csv\",\n        datadir * \"hapmap3\",\n        pvalfile = \"snpset.pval.txt\", \n        analysistype = \"snpset\",\n        snpset = 50:55)","category":"page"},{"location":"","page":"Home","title":"Home","text":"run = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.045957\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.043228\n\n\n\n\n\n\nWithin-subject variance estimation by robust regression (WiSER)\n\nMean Formula:\ny ~ 1 + sex + onMeds\nRandom Effects Formula:\ny ~ 1\nWithin-Subject Variance Formula:\ny ~ 1 + sex + onMeds\n\nNumber of individuals/clusters: 324\nTotal observations: 3240\n\nFixed-effects parameters:\n────────────────────────────────────────────────────────\n                  Estimate  Std. Error       Z  Pr(>|Z|)\n────────────────────────────────────────────────────────\nβ1: (Intercept)  13.2282     0.146459    90.32    <1e-99\nβ2: sex          -3.29295    0.2101     -15.67    <1e-54\nβ3: onMeds        0.459585   0.0596002    7.71    <1e-13\nτ1: (Intercept)   0.792508   0.0850728    9.32    <1e-19\nτ2: sex          -0.2865     0.0970732   -2.95    0.0032\nτ3: onMeds        0.422303   0.063825     6.62    <1e-10\n────────────────────────────────────────────────────────\nRandom effects covariance matrix Σγ:\n \"γ1: (Intercept)\"  3.32057","category":"page"},{"location":"","page":"Home","title":"Home","text":"run(`head snpset.pval.txt`);","category":"page"},{"location":"","page":"Home","title":"Home","text":"The pvalue of snps indexed at 50:55 is betapval: 2.315617121196509e-5, taupval: 3.972993706371914e-10","category":"page"},{"location":"","page":"Home","title":"Home","text":"# clean up\nrm(\"snpset.pval.txt\", force=true)\nrm(\"trajgwas.null.txt\", force=true)","category":"page"},{"location":"","page":"Home","title":"Home","text":"In the following example we run a SNP-set test on the annotated SNP-set file.","category":"page"},{"location":"","page":"Home","title":"Home","text":"run(`head ../data/hapmap_snpsetfile.txt`);","category":"page"},{"location":"","page":"Home","title":"Home","text":"gene1 rs10458597\ngene1 rs12562034\ngene1 rs2710875\ngene1 rs11260566\ngene1 rs1312568\ngene1 rs35154105\ngene1 rs16824508\ngene1 rs2678939\ngene1 rs7553178\ngene1 rs13376356","category":"page"},{"location":"","page":"Home","title":"Home","text":"trajgwas(@formula(y ~ 1 + sex + onMeds),\n        @formula(y ~ 1),\n        @formula(y ~ 1 + sex + onMeds),\n        :id,\n        datadir * \"trajgwas_plinkex.csv\",\n        datadir * \"hapmap3\",\n        pvalfile = \"snpset.pval.txt\", \n        analysistype = \"snpset\",\n        snpset = datadir * \"/hapmap_snpsetfile.txt\")","category":"page"},{"location":"","page":"Home","title":"Home","text":"run = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.063600\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.062349\n\n\n\n\n\n\nWithin-subject variance estimation by robust regression (WiSER)\n\nMean Formula:\ny ~ 1 + sex + onMeds\nRandom Effects Formula:\ny ~ 1\nWithin-Subject Variance Formula:\ny ~ 1 + sex + onMeds\n\nNumber of individuals/clusters: 324\nTotal observations: 3240\n\nFixed-effects parameters:\n────────────────────────────────────────────────────────\n                  Estimate  Std. Error       Z  Pr(>|Z|)\n────────────────────────────────────────────────────────\nβ1: (Intercept)  13.2282     0.146459    90.32    <1e-99\nβ2: sex          -3.29295    0.2101     -15.67    <1e-54\nβ3: onMeds        0.459585   0.0596002    7.71    <1e-13\nτ1: (Intercept)   0.792508   0.0850728    9.32    <1e-19\nτ2: sex          -0.2865     0.0970732   -2.95    0.0032\nτ3: onMeds        0.422303   0.063825     6.62    <1e-10\n────────────────────────────────────────────────────────\nRandom effects covariance matrix Σγ:\n \"γ1: (Intercept)\"  3.32057","category":"page"},{"location":"","page":"Home","title":"Home","text":"pretty_table(first(CSV.read(\"snpset.pval.txt\", DataFrame; delim=\"\\t\"), 5), tf = tf_markdown)","category":"page"},{"location":"","page":"Home","title":"Home","text":"|\u001b[1m snpsetid \u001b[0m|\u001b[1m nsnps \u001b[0m|\u001b[1m  betapval \u001b[0m|\u001b[1m   taupval \u001b[0m|\n|\u001b[90m  String7 \u001b[0m|\u001b[90m Int64 \u001b[0m|\u001b[90m   Float64 \u001b[0m|\u001b[90m   Float64 \u001b[0m|\n|----------|-------|-----------|-----------|\n|    gene1 |    93 |  0.111864 |  0.011595 |\n|    gene2 |    93 | 0.0249929 | 0.0648265 |\n|    gene3 |    93 |  0.131741 | 0.0298884 |\n|    gene4 |    92 |  0.010327 | 0.0584591 |\n|    gene5 |    93 | 0.0303905 | 0.0924954 |","category":"page"},{"location":"","page":"Home","title":"Home","text":"# clean up\nrm(\"snpset.pval.txt\", force=true)\nrm(\"trajgwas.null.txt\", force=true)","category":"page"},{"location":"","page":"Home","title":"Home","text":"In the following example we run a SNP-set test on every 15 SNPs.","category":"page"},{"location":"","page":"Home","title":"Home","text":"trajgwas(@formula(y ~ 1 + sex + onMeds),\n        @formula(y ~ 1),\n        @formula(y ~ 1 + sex + onMeds),\n        :id,\n        datadir * \"trajgwas_plinkex.csv\",\n        datadir * \"hapmap3\",\n        pvalfile = \"snpset.pval.txt\", \n        analysistype = \"snpset\",\n        snpset = 15)","category":"page"},{"location":"","page":"Home","title":"Home","text":"run = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.044625\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.038447\n\n\n\n\n\n\nWithin-subject variance estimation by robust regression (WiSER)\n\nMean Formula:\ny ~ 1 + sex + onMeds\nRandom Effects Formula:\ny ~ 1\nWithin-Subject Variance Formula:\ny ~ 1 + sex + onMeds\n\nNumber of individuals/clusters: 324\nTotal observations: 3240\n\nFixed-effects parameters:\n────────────────────────────────────────────────────────\n                  Estimate  Std. Error       Z  Pr(>|Z|)\n────────────────────────────────────────────────────────\nβ1: (Intercept)  13.2282     0.146459    90.32    <1e-99\nβ2: sex          -3.29295    0.2101     -15.67    <1e-54\nβ3: onMeds        0.459585   0.0596002    7.71    <1e-13\nτ1: (Intercept)   0.792508   0.0850728    9.32    <1e-19\nτ2: sex          -0.2865     0.0970732   -2.95    0.0032\nτ3: onMeds        0.422303   0.063825     6.62    <1e-10\n────────────────────────────────────────────────────────\nRandom effects covariance matrix Σγ:\n \"γ1: (Intercept)\"  3.32057","category":"page"},{"location":"","page":"Home","title":"Home","text":"pretty_table(first(CSV.read(\"snpset.pval.txt\", DataFrame), 5), tf = tf_markdown)","category":"page"},{"location":"","page":"Home","title":"Home","text":"|\u001b[1m startchr \u001b[0m|\u001b[1m startpos \u001b[0m|\u001b[1m startsnpid \u001b[0m|\u001b[1m endchr \u001b[0m|\u001b[1m   endpos \u001b[0m|\u001b[1m   endsnpid \u001b[0m|\u001b[1m    betapval \u001b[0m|\u001b[1m     taupval \u001b[0m|\n|\u001b[90m    Int64 \u001b[0m|\u001b[90m    Int64 \u001b[0m|\u001b[90m   String15 \u001b[0m|\u001b[90m  Int64 \u001b[0m|\u001b[90m    Int64 \u001b[0m|\u001b[90m   String15 \u001b[0m|\u001b[90m     Float64 \u001b[0m|\u001b[90m     Float64 \u001b[0m|\n|----------|----------|------------|--------|----------|------------|-------------|-------------|\n|        1 |   554484 | rs10458597 |      1 |  3431124 | rs12093117 |  3.83046e-6 | 2.24303e-10 |\n|        1 |  3633945 | rs10910017 |      1 |  6514524 |   rs932112 | 0.000127922 |  7.94764e-6 |\n|        1 |  6715827 |   rs441515 |      1 |  9534606 |  rs4926480 |  8.10353e-5 |  6.11848e-7 |\n|        1 |  9737551 | rs12047054 |      1 | 12559747 |  rs4845907 | 0.000425108 |  1.15311e-8 |\n|        1 | 12760427 |   rs848577 |      1 | 16021797 |  rs6679870 |  2.75832e-5 |  0.00028553 |","category":"page"},{"location":"","page":"Home","title":"Home","text":"# clean up\nrm(\"snpset.pval.txt\", force=true)\nrm(\"trajgwas.null.txt\", force=true)","category":"page"},{"location":"#Matching-Indicies","page":"Home","title":"Matching Indicies","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"In some cases, there are only a subset of individuals with both genetic data and covariate information available. The null model must be fit on a subset of the individuals with the genetic data. The rows can be specified with the argument covrowinds if you pass in a covariate file. The genetic indicies can be specified with the geneticrowinds argument. ","category":"page"},{"location":"","page":"Home","title":"Home","text":"For simplicity, we have implemented a function matchindices(meanformula, reformula, wsvarformula, idvar, df, geneticsamples) which can be used to do this. Input the mean, random effects, and within-subject variance formulas, the grouping (id) variable, the dataframe (or table), and a vector of the IDs in the order of the genetic file and it returns covrowmask, geneticrowmask for matching indicies in a covariate file and geneticfile.","category":"page"},{"location":"","page":"Home","title":"Home","text":"Note: the idvar in the dataframe and the geneticsamples vector must have the same element type. To convert a vector of integers to strings string.(intvector) can be used. To go from a vector of strings to integers you can use\"  map(x -> parse(Int, x), stringvectoparse).","category":"page"},{"location":"","page":"Home","title":"Home","text":"famfileids = CSV.read(datadir * \"hapmap3.fam\", DataFrame, header = false)[!, 1] # famfile contains the sample IDs for PLINK files","category":"page"},{"location":"","page":"Home","title":"Home","text":"324-element Vector{String7}:\n \"A1\"\n \"2\"\n \"3\"\n \"4\"\n \"5\"\n \"6\"\n \"7\"\n \"8\"\n \"9\"\n \"10\"\n \"11\"\n \"12\"\n \"13\"\n ⋮\n \"313\"\n \"314\"\n \"315\"\n \"316\"\n \"317\"\n \"318\"\n \"319\"\n \"320\"\n \"321\"\n \"322\"\n \"323\"\n \"Z324\"","category":"page"},{"location":"","page":"Home","title":"Home","text":"covdf = CSV.read(datadir * \"trajgwas_plinkex.csv\", DataFrame)\npretty_table(first(covdf, 11), tf = tf_markdown)","category":"page"},{"location":"","page":"Home","title":"Home","text":"|\u001b[1m     sex \u001b[0m|\u001b[1m  onMeds \u001b[0m|\u001b[1m    snp1 \u001b[0m|\u001b[1m    snp2 \u001b[0m|\u001b[1m    snp3 \u001b[0m|\u001b[1m    snp4 \u001b[0m|\u001b[1m       y \u001b[0m|\u001b[1m      id \u001b[0m|\n|\u001b[90m Float64 \u001b[0m|\u001b[90m Float64 \u001b[0m|\u001b[90m Float64 \u001b[0m|\u001b[90m Float64 \u001b[0m|\u001b[90m Float64 \u001b[0m|\u001b[90m Float64 \u001b[0m|\u001b[90m Float64 \u001b[0m|\u001b[90m String7 \u001b[0m|\n|---------|---------|---------|---------|---------|---------|---------|---------|\n|     0.0 |     1.0 |     0.0 |     1.0 |     2.0 |     0.0 | 12.2667 |      A1 |\n|     0.0 |     0.0 |     0.0 |     1.0 |     2.0 |     0.0 | 10.2681 |      A1 |\n|     0.0 |     0.0 |     0.0 |     1.0 |     2.0 |     0.0 |  12.166 |      A1 |\n|     0.0 |     0.0 |     0.0 |     1.0 |     2.0 |     0.0 | 11.8797 |      A1 |\n|     0.0 |     0.0 |     0.0 |     1.0 |     2.0 |     0.0 | 12.8127 |      A1 |\n|     0.0 |     0.0 |     0.0 |     1.0 |     2.0 |     0.0 | 9.98766 |      A1 |\n|     0.0 |     0.0 |     0.0 |     1.0 |     2.0 |     0.0 | 12.1408 |      A1 |\n|     0.0 |     1.0 |     0.0 |     1.0 |     2.0 |     0.0 | 13.2058 |      A1 |\n|     0.0 |     0.0 |     0.0 |     1.0 |     2.0 |     0.0 | 11.3631 |      A1 |\n|     0.0 |     1.0 |     0.0 |     1.0 |     2.0 |     0.0 | 15.2511 |      A1 |\n|     0.0 |     0.0 |     0.0 |     0.0 |     2.0 |     2.0 |  12.746 |       2 |","category":"page"},{"location":"","page":"Home","title":"Home","text":"covrowmask, geneticrowmask = matchindices(@formula(y ~ 1 + sex + onMeds),\n        @formula(y ~ 1),\n        @formula(y ~ 1 + sex + onMeds),\n        :id, covdf, famfileids);","category":"page"},{"location":"","page":"Home","title":"Home","text":"trajgwas(@formula(y ~ 1 + sex + onMeds),\n        @formula(y ~ 1),\n        @formula(y ~ 1 + sex + onMeds),\n        :id,\n        datadir * \"trajgwas_plinkex.csv\",\n        datadir * \"hapmap3\",\n        pvalfile = pvalpath,\n        nullfile = nullpath,\n        covrowinds = covrowmask,\n        geneticrowinds = geneticrowmask)","category":"page"},{"location":"","page":"Home","title":"Home","text":"run = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.049927\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.046026\n\n\n\n\n\n\nWithin-subject variance estimation by robust regression (WiSER)\n\nMean Formula:\ny ~ 1 + sex + onMeds\nRandom Effects Formula:\ny ~ 1\nWithin-Subject Variance Formula:\ny ~ 1 + sex + onMeds\n\nNumber of individuals/clusters: 324\nTotal observations: 3240\n\nFixed-effects parameters:\n────────────────────────────────────────────────────────\n                  Estimate  Std. Error       Z  Pr(>|Z|)\n────────────────────────────────────────────────────────\nβ1: (Intercept)  13.2282     0.146459    90.32    <1e-99\nβ2: sex          -3.29295    0.2101     -15.67    <1e-54\nβ3: onMeds        0.459585   0.0596002    7.71    <1e-13\nτ1: (Intercept)   0.792508   0.0850728    9.32    <1e-19\nτ2: sex          -0.2865     0.0970732   -2.95    0.0032\nτ3: onMeds        0.422303   0.063825     6.62    <1e-10\n────────────────────────────────────────────────────────\nRandom effects covariance matrix Σγ:\n \"γ1: (Intercept)\"  3.32057","category":"page"},{"location":"","page":"Home","title":"Home","text":"# clean up\nrm(\"trajgwas.null.txt\", force=true)\nrm(\"trajgwas.pval.txt\", force=true)","category":"page"},{"location":"#Plotting-Results","page":"Home","title":"Plotting Results","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"To plot the GWAS results, we recommend using the MendelPlots.jl package.","category":"page"},{"location":"#Multiple-Plink-file-sets","page":"Home","title":"Multiple Plink file sets","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"In large scale studies, genotypes data are split into multiple Plink files, e.g., by chromosome. Then GWAS analysis can be done in parallel. This can be achieved by two steps.","category":"page"},{"location":"","page":"Home","title":"Home","text":"Let's first create demo data by splitting hapmap3 according to chromosome:","category":"page"},{"location":"","page":"Home","title":"Home","text":"# split example hapmap3 data according to chromosome\nSnpArrays.split_plink(datadir * \"hapmap3\", :chromosome; prefix=datadir * \"hapmap3.chr.\")\nreaddir(glob\"hapmap3.chr.*\", datadir)","category":"page"},{"location":"","page":"Home","title":"Home","text":"75-element Vector{String}:\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.1.bed\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.1.bim\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.1.fam\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.10.bed\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.10.bim\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.10.fam\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.11.bed\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.11.bim\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.11.fam\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.12.bed\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.12.bim\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.12.fam\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.13.bed\"\n ⋮\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.6.bed\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.6.bim\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.6.fam\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.7.bed\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.7.bim\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.7.fam\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.8.bed\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.8.bim\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.8.fam\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.9.bed\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.9.bim\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.9.fam\"","category":"page"},{"location":"","page":"Home","title":"Home","text":"Step 1: Fit the null model. Setting third argument geneticfile to nothing instructs trajgwas function to fit the null model only.","category":"page"},{"location":"","page":"Home","title":"Home","text":"nm = trajgwas(@formula(y ~ 1 + sex + onMeds),\n        @formula(y ~ 1),\n        @formula(y ~ 1 + sex + onMeds),\n        :id,\n        datadir * \"trajgwas_plinkex.csv\",\n        nothing)","category":"page"},{"location":"","page":"Home","title":"Home","text":"run = 1, ‖Δβ‖ = 0.037090, ‖Δτ‖ = 0.136339, ‖ΔL‖ = 0.005441, status = LOCALLY_SOLVED, time(s) = 0.045024\nrun = 2, ‖Δβ‖ = 0.000913, ‖Δτ‖ = 0.019810, ‖ΔL‖ = 0.001582, status = LOCALLY_SOLVED, time(s) = 0.047245\n\n\n\n\n\n\nWithin-subject variance estimation by robust regression (WiSER)\n\nMean Formula:\ny ~ 1 + sex + onMeds\nRandom Effects Formula:\ny ~ 1\nWithin-Subject Variance Formula:\ny ~ 1 + sex + onMeds\n\nNumber of individuals/clusters: 324\nTotal observations: 3240\n\nFixed-effects parameters:\n────────────────────────────────────────────────────────\n                  Estimate  Std. Error       Z  Pr(>|Z|)\n────────────────────────────────────────────────────────\nβ1: (Intercept)  13.2282     0.146459    90.32    <1e-99\nβ2: sex          -3.29295    0.2101     -15.67    <1e-54\nβ3: onMeds        0.459585   0.0596002    7.71    <1e-13\nτ1: (Intercept)   0.792508   0.0850728    9.32    <1e-19\nτ2: sex          -0.2865     0.0970732   -2.95    0.0032\nτ3: onMeds        0.422303   0.063825     6.62    <1e-10\n────────────────────────────────────────────────────────\nRandom effects covariance matrix Σγ:\n \"γ1: (Intercept)\"  3.32057","category":"page"},{"location":"","page":"Home","title":"Home","text":"Step 2: GWAS for each chromosome.","category":"page"},{"location":"","page":"Home","title":"Home","text":"# this part can be submitted as separate jobs\nfor chr in 1:23\n    plinkfile = datadir * \"hapmap3.chr.\" * string(chr)\n    pvalfile = plinkfile * \".pval.txt\" \n    trajgwas(nm, plinkfile, pvalfile=pvalfile)\nend","category":"page"},{"location":"","page":"Home","title":"Home","text":"# show the result files\nreaddir(glob\"*.pval.txt\", datadir)","category":"page"},{"location":"","page":"Home","title":"Home","text":"23-element Vector{String}:\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.1.pval.txt\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.10.pval.txt\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.11.pval.txt\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.12.pval.txt\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.13.pval.txt\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.14.pval.txt\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.15.pval.txt\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.16.pval.txt\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.17.pval.txt\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.18.pval.txt\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.19.pval.txt\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.2.pval.txt\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.20.pval.txt\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.21.pval.txt\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.22.pval.txt\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.23.pval.txt\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.3.pval.txt\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.4.pval.txt\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.5.pval.txt\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.6.pval.txt\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.7.pval.txt\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.8.pval.txt\"\n \"/Users/xyz/.julia/dev/TrajGWAS/data/hapmap3.chr.9.pval.txt\"","category":"page"},{"location":"","page":"Home","title":"Home","text":"In the rare situations where the multiple sets of Plink files lack the fam file or the corresponding bed and bim files have different filenames, users can explicitly supply bed filename, bim file name, and number of individuals. Replace Step 2 by ","category":"page"},{"location":"","page":"Home","title":"Home","text":"Step 2': GWAS for each chromosome.","category":"page"},{"location":"","page":"Home","title":"Home","text":"# this part can be submitted as separate jobs\nfor chr in 1:23\n    bedfile = datadir * \"hapmap3.chr.\" * string(chr) * \".bed\"\n    bimfile = datadir * \"hapmap3.chr.\" * string(chr) * \".bim\"\n    pvalfile = datadir * \"hapmap3.chr.\" * string(chr) * \".pval.txt\"\n    trajgwas(nm, bedfile, bimfile, 324; pvalfile=pvalfile)\nend","category":"page"},{"location":"","page":"Home","title":"Home","text":"# clean up\nrm(\"trajgwas.null.txt\", force=true)\nisfile(datadir * \"fittednullmodel.jld2\") && rm(datadir * \"fittednullmodel.jld2\")\nfor chr in 1:23\n    pvalfile = datadir * \"hapmap3.chr.\" * string(chr) * \".pval.txt\"\n    rm(pvalfile, force=true)\nend\nfor chr in 1:26\n    plinkfile = datadir * \"hapmap3.chr.\" * string(chr)\n    rm(plinkfile * \".bed\", force=true)\n    rm(plinkfile * \".fam\", force=true)\n    rm(plinkfile * \".bim\", force=true)\nend","category":"page"},{"location":"#Multiple-file-sets-on-cluster","page":"Home","title":"Multiple file sets on cluster","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"For running the score tests on a cluster, it would be desirable to fit a null model on a single machine first, and save the model as a serialized Julia object (.jls). For example:","category":"page"},{"location":"","page":"Home","title":"Home","text":"using DataFrames, CSV\nusing Statistics\nusing TrajGWAS\nusing Ipopt, WiSER\nusing LinearAlgebra\nusing BGEN\n# fit the null model\nBLAS.set_num_threads(1)\nsolver = Ipopt.Optimizer()\nsolver_config = Dict(\"print_level\" => 1, \n    \"watchdog_shortened_iter_trigger\" => 5,\n    \"max_iter\" => 120)\n\nbp_data = CSV.read(\"bp.csv\", DataFrame)\n@time nm = trajgwas(@formula(dbp ~ 1 + SEX + age + age_sq +\n        PC1 + PC2 + PC3 + PC4 + PC5 + bmi),\n    @formula(dbp ~ 1 + age),\n    @formula(dbp ~ 1 + SEX + age + age_sq +\n        PC1 + PC2 + PC3 + PC4 + PC5 +\n        bmi),\n    :FID, # subject ID\n    bp_data,\n    nothing;\n    nullfile=\"dbp.null.txt\",\n    solver=solver,\n    solver_config=solver_config,\n    init = nothing, # may change to `x -> WiSER.init_ls!(x; gniters=0)`\n    runs=10\n)\n\nprintln(nm)\nusing Serialization\nopen(\"null.model.jls\", \"w\") do io\n    Serialization.serialize(io, nm)\nend","category":"page"},{"location":"","page":"Home","title":"Home","text":"Then, the fitted null model would be used for the score test. It could be desirable to configure each job to run on a slice of SNPs on a BGEN file for higher throughput. The julia script for score test (scoretest_bp.jl) for a slice of BGEN file would look like:","category":"page"},{"location":"","page":"Home","title":"Home","text":"using DataFrames, CSV\nusing Statistics\nusing TrajGWAS\nusing WiSER\nusing LinearAlgebra\nusing BGEN\n# fit the null model\nBLAS.set_num_threads(1)\n\n\nusing Serialization\n\nbgendir = ARGS[1] \nchr = ARGS[2] # 1 to 22\nfitted_null = ARGS[3] # \"null.model.jls\"\npvalfile = ARGS[4] # \"sbp.test.diabetics.chr$(chr).txt\"\nchunkidx = parse(Int, ARGS[5])\nnchunks  = parse(Int, ARGS[6])\n\nnm = open(deserialize, fitted_null)\ngenetic_iids_subsample = nm.ids\n\nbgenfilename = bgendir * \"/Chr$(chr)\" # to analyze, for example, /path/to/bgen/Chr5.bgen\nsamplefilename = bgendir * \"/Samples.sample\" # .sample file compatible with BGEN\nmfifilename = bgendir * \"/mfi_chr$(chr).txt\" # \"MFI\" file, an external file with MAF + info score\t\nukb_data = Bgen(bgenfilename * \".bgen\"; sample_path = samplefilename)\ngenetic_iids = map(x -> parse(Int, split(x, \" \")[1]), samples(ukb_data))\n\norder_dict = Dict{Int, Int}()\nfor (i, iid) in enumerate(genetic_iids)\n    order_dict[iid] = i\nend\n\nsample_indicator = falses(length(genetic_iids))\nfor v in genetic_iids_subsample\n    sample_indicator[order_dict[v]] = true # extract only the samples being used for the analysis\nend\n\n# GWAS for each chromosome\n\n## pre-filtering SNPs not passing the criteria (MAF > 0.002, info score > 0.3)\nmin_maf = 0.002\nmin_info_score = 0.3\nmin_hwe_pval = 1e-10\nmfi = CSV.read(mfifilename, DataFrame; header=false)\nmfi.Column8 = map(x -> x == \"NA\" ? NaN : parse(Float64, x), mfi.Column8) # Column8: info score\nsnpmask = (mfi.Column6 .> min_maf) .& (mfi.Column8 .> 0.3) # Column6: MAF\n\n## compute range to run the analysis\nchunksize = n_variants(ukb_data) ÷ nchunks + (n_variants(ukb_data) % nchunks > 0 ? 1 : 0)\nstartidx = chunksize * (chunkidx - 1) + 1\nendidx = min(chunksize * chunkidx, n_variants(ukb_data))\nsnpmask = snpmask[startidx:endidx]\n\nprintln(\"running for variants $startidx to $endidx\")\n\n# rearrange data in nm so that it matches bgen data\nnullinds = indexin(genetic_iids[sample_indicator], nm.ids)\nnm.obswts .= isempty(nm.obswts) ? nm.obswts : nm.obswts[nullinds]\nnm.ids .= nm.ids[nullinds]\nnm.nis .= nm.nis[nullinds]\nnm.data .= nm.data[nullinds]\n@assert genetic_iids[sample_indicator] == nm.ids \"there is some issue -- sampleids not matching\"\n    \ntrajgwas(nm, bgenfilename * \".bgen\", count(sample_indicator);\n    samplepath=samplefilename,\n    pvalfile=pvalfile,\n    snpinds=snpmask,\n    min_hwe_pval = min_hwe_pval,\n    bgenrowinds = sample_indicator,\n    startidx = startidx,\n    endidx = endidx,\n    usespa=true)\n","category":"page"},{"location":"","page":"Home","title":"Home","text":"Command-line arguments\nArgument 1: directory for the BGEN files. BGEN files (.bgen), BGEN index files (.bgen.bgi), and MFI files (.txt) should be included there.\nArgument 2: chromosome\nArgument 3: fitted null model (.jls)\nArgument 4: path for the result p-value file\nArgument 5: chunk index (1-based)\nArgument 6: number of chunks","category":"page"},{"location":"","page":"Home","title":"Home","text":"The code above runs the analysis on ARGS[5]-th slice out of ARGS[6] slices of chromosome ARGS[2].","category":"page"},{"location":"","page":"Home","title":"Home","text":"Note: an index file (.bgen.bgi) is required for this slicing of BGEN file. See this link to see how to create one.","category":"page"},{"location":"","page":"Home","title":"Home","text":"Then, the following script could be used for a cluster managed by Sun Grid Engine: (sbp_diabetes.sh)","category":"page"},{"location":"","page":"Home","title":"Home","text":"#!/bin/bash\n#$ -cwd\n#$ -o joblog.$JOB_ID.$TASK_ID\n#$ -j y\n#$ -pe shared 2\n#$ -l h_rt=8:00:00,h_data=8G,arch=intel*\n# Email address to notify\n##$ -M $USER@mail\n# Notify when\n#$ -m a\n#  Job array indexes\n#$ -t 1-352:1\n\nNCHUNKS=16\nCHUNKIDX=$(( (${SGE_TASK_ID} - 1) % ${NCHUNKS} + 1 ))\nCHR=$(( (${SGE_TASK_ID} - 1) / ${NCHUNKS} + 1))\n\nPROJECTDIR=/user/dir/jobscripts\nBGENDIR=/user/dir/imputed\nFITTED_NULL=/user/dir/null.model.jls\nPVALFILE=/user/dir/pvalfiles/sbp.test.diabetes.chr${CHR}.${CHUNKIDX}of${NCHUNKS}.txt\n\nmodule load julia\ntime julia --project=${PROJECTDIR} ${PROJECTDIR}/scoretest_bp.jl ${BGENDIR} ${CHR} ${FITTED_NULL} ${PVALFILE} ${CHUNKIDX} ${NCHUNKS}","category":"page"},{"location":"","page":"Home","title":"Home","text":"and this could be submitted using the qsub command.","category":"page"},{"location":"#Troubleshooting","page":"Home","title":"Troubleshooting","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"If there are issues you're encountering with running TrajGWAS, the following are possible remedies.","category":"page"},{"location":"","page":"Home","title":"Home","text":"Null Model\nIssues with null model convergence may be solved by choosing alternate starting values for parameters, using a different solver, transforming variables, and increasing the number of runs (WiSER runs). These are detailed in the WiSER documentation here. init = x -> WiSER.init_ls!(x; gniters=0) works fine in general. \nGWAS Results\nIf you use the score test instead of the SPA-score test (SPA is default for single-SNP analyses), then there can be inflation in type I error and decreased power when (a) the sample size is small, (b) the number of repeated measures is low, or (c) the variants analyzed are rare with low minor allele frequencies. In these cases, the score test is not optimal and it is suggested to use the SPA version (usespa=true). SPA is only implemented for single-SNP analyses. These issues can occur in both Wald and score tests. ","category":"page"},{"location":"","page":"Home","title":"Home","text":"If you notice any problems with your output or results, file an issue. ","category":"page"}]
}
